
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7. Functions and Procedures &#8212; Sireum Logika</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sireum.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <script src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script src="../../_static/js/jquery-fix.js"></script>
    <script src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../../_static/logika.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="6. Loops and Loop Invariants" href="../06-loops-invariants-induction/index.html" />
  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          Logika</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../doc/01-getting-started/index.html">Download</a></li>
                <li><a href="../../doc/index.html">Documentation</a></li>
                <li><a href="../index.html">Course Notes</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html"> <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#"> <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">7. Functions and Procedures</a><ul>
<li><a class="reference internal" href="#the-client-service-model">7.1. The Client-Service Model</a></li>
<li><a class="reference internal" href="#contracts-pre-post-conditions-and-the-modifies-clause">7.2. Contracts : Pre-/Post-conditions and the Modifies clause</a><ul>
<li><a class="reference internal" href="#specification">7.2.1. Specification</a></li>
<li><a class="reference internal" href="#using-specifications">7.2.2. Using Specifications</a></li>
<li><a class="reference internal" href="#forwards-law-for-function-definition-and-call">7.2.3. Forwards Law for Function Definition and Call</a></li>
<li><a class="reference internal" href="#optional-section-how-to-work-from-specifications-to-code">7.2.4. Optional Section: How to Work from Specifications To Code</a></li>
<li><a class="reference internal" href="#optional-section-backwards-law-for-function-invocation">7.2.5. Optional Section: Backwards Law for Function Invocation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#global-variables-and-procedures">7.3. Global Variables and Procedures</a><ul>
<li><a class="reference internal" href="#global-variables-that-are-updated">7.3.1. Global Variables that are Updated</a></li>
<li><a class="reference internal" href="#deduction-law-for-procedures">7.3.2. Deduction Law for Procedures</a></li>
<li><a class="reference internal" href="#global-variable-invariants">7.3.3. Global-Variable Invariants</a><ul>
<li><a class="reference internal" href="#law-for-global-invariants-and-procedure-calls">Law for Global Invariants and Procedure Calls</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#functions-that-call-functions">7.4. Functions that Call Functions</a><ul>
<li><a class="reference internal" href="#functions-that-call-themselves">7.4.1. Functions that Call Themselves</a></li>
</ul>
</li>
<li><a class="reference internal" href="#industry-applications">7.5. Industry Applications</a><ul>
<li><a class="reference internal" href="#software-design-design-by-contract">7.5.1. Software Design: Design-by-Contract</a></li>
<li><a class="reference internal" href="#language-implementation">7.5.2. Language Implementation</a><ul>
<li><a class="reference internal" href="#type-systems">Type Systems</a></li>
<li><a class="reference internal" href="#note-on-defensive-programming">Note on Defensive Programming</a></li>
<li><a class="reference internal" href="#beyond-type-and-defensive-programming">Beyond Type and Defensive Programming</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#summary">7.6. Summary</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <br/>
<font color="darkgray">
<big><big><b>
Logika: Programming Logics
</b></big></big>
</font>
<br/>
<font color="black">
<big><big><big><big><b>
7. Functions and Procedures
</b></big></big></big></big>
</font><section id="functions-and-procedures">
<span id="functions-procedures"></span><h1><span class="section-number">7. </span>Functions and Procedures<a class="headerlink" href="#functions-and-procedures" title="Permalink to this headline">¶</a></h1>
<p>A function or procedure (from here forward function unless the distinction is
relevant) is a named body of
commands that does significant work.  It may take parameter and or return values.
It is analogous to methods or even classes in C# or Java. When we define a
function, we should summarize its knowledge-production capabilities. This is
critical,  because we assemble a program by connecting a collection of functions,
and therefore must know what they are capable of doing.</p>
<p>As you reviewed in calculus, a function maps each element of a domain to a single
element of a co-domain.  So the equation for a line <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">ax</span> <span class="pre">+</span> <span class="pre">b</span></code> is a function
mapping real-numbers to real numbers, as long as each <code class="docutils literal notranslate"><span class="pre">x</span></code> maps to exactly one
<code class="docutils literal notranslate"><span class="pre">y</span></code> (no vertical lines).  Because of this, a methods/subroutines which return
a value are often referred to as “functions”.</p>
<p>But as you have seen in C# and Java, there are functions which return nothing, i.e.
<em>void-type</em> (<em>Unit-type</em> in Logika).  These functions may change no programmatic
values ( Java’s system.out.println()) or they may change class fields (like
setters in Java).  In non-object oriented programming, like C, they may even
change  <em>global</em> variables.  We call a function that
updates a global variable, a <em>procedure</em> (it may also have a return value).
For those with only an object oriented background, a global
variable is analogous to a <em>public static &lt;class-field&gt;</em>; it is globally visible
and mutable.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Traditionally, “function” refers to a method with a non-Unit (non-void) return
type, where as “procedure” has a Unit (void) return type.
Readers should be aware that there are contemporary programming languages
that have different syntax and semantics for functions and procedures.</p>
</div>
<section id="the-client-service-model">
<h2><span class="section-number">7.1. </span>The Client-Service Model<a class="headerlink" href="#the-client-service-model" title="Permalink to this headline">¶</a></h2>
<p>Whether implicitly or explicitly, we create contracts with every function we construct.
We intend, that as long as the parameters passed in meet certain conditions, the
function will produce a particular effect.  This effect can be achieved by
manipulating shared data and/or returning values.</p>
<p>So we can think of a program (the client) composing a solution to a problem.
Consider a program that calculates a real-root of the quadratic equation.</p>
<div class="math notranslate nohighlight">
\[(b ± sqrt(b ^2 - 4ac) / 2a\]</div>
<p>Which may result in a LISP-esque program like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(defun root1 (a, b, c)

  (div (add (b) (sqrt (subt (mult (b) (b))
                                 (mult( (4) (mult (a) (c))))))
                 (mult (2) (a))))
)
; we just calculate the &quot;b +&quot; root
</pre></div>
</div>
<p>Here the client, function root1, knows the values of <code class="docutils literal notranslate"><span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c</span></code> and has access to math services
<em>{div(ide), add, sqrt[square root], subt(ract), mult(iply)}</em>.  The implicit
contract for the binary operators is something like.</p>
<blockquote>
<div><p>add (x) (y) – provided two real numbers x and y, add returns the real number value x + y</p>
</div></blockquote>
<p>and for the unary operator</p>
<blockquote>
<div><p>sqrt (x) – provided any positive real number x, sqrt returns the positive real square root of x</p>
</div></blockquote>
<p>The client has no insight on how these functions accomplish their objectives only the
preconditions for their use, and the conditional guarantees (post-conditions) made
about the returned value.</p>
<p>To see if this program is valid, the <em>client</em> must ensure that the precondition
of each <em>service</em> is met.  For this program, it is not necessarily the case that
all service preconditions are met.  We will discuss which one fails to have its
precondition met latter.</p>
</section>
<section id="contracts-pre-post-conditions-and-the-modifies-clause">
<h2><span class="section-number">7.2. </span>Contracts : Pre-/Post-conditions and the Modifies clause<a class="headerlink" href="#contracts-pre-post-conditions-and-the-modifies-clause" title="Permalink to this headline">¶</a></h2>
<p>A function is a “mini-program”:
it has inputs, namely the arguments assigned to its parameters, and
it has outputs, namely the information returned as the function’s answer.
It acts like a logic gate or chip, with “input wires” and “output wires”.</p>
<p>Here is an example that shows the format we use for writing a function:</p>
<aside class="sidebar">
<p class="sidebar-title">Logika function syntax and semantics</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 48%" />
<col style="width: 52%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>def divides( a: Z, b: Z) : B =  {</p></td>
<td><div class="line-block">
<div class="line">def <em>function_name</em></div>
<div class="line">(&lt;paramter_List&gt;)</div>
<div class="line-block">
<div class="line">&lt;param_name : type&gt; , …</div>
</div>
<div class="line">: <em>func_return_type</em> = {</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Function return types</p></td>
<td><div class="line-block">
<div class="line">Z, ZS, B, BS, Unit</div>
<div class="line">Unit is analogous to C# void</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>l”””{</p></td>
<td><p>Program logic proof may contain</p></td>
</tr>
<tr class="row-even"><td><p>&lt; pre or requires &gt;</p></td>
<td><p>Pre conditions</p></td>
</tr>
<tr class="row-odd"><td><p>&lt;modifies &lt;var list&gt;&gt;</p></td>
<td><p>list of global vars and parameters
modified in the function</p></td>
</tr>
<tr class="row-even"><td><p><em>KEYWORD</em> <strong>result</strong></p></td>
<td><p>the value returned (as the variable
named may be out of scope)</p></td>
</tr>
<tr class="row-odd"><td><blockquote>
<div><p>&lt;post or ensures&gt; &lt;result ==&gt;</p>
</div></blockquote>
<div class="line-block">
<div class="line">}”””</div>
</div>
</td>
<td><p>Post conditions
modified in the function</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line-block">
<div class="line">…</div>
</div>
<div class="line">&lt;return var_name&gt;</div>
</div>
<p>}</p>
</td>
<td><p>If the function has a non-Unit
return a type. It must return a
var/val of that type</p></td>
</tr>
</tbody>
</table>
</aside>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">divides</span><span class="p">(</span> <span class="n">a</span><span class="p">:</span> <span class="n">Z</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">B</span> <span class="o">=</span>  <span class="p">{</span>
<span class="linenos"> 4</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 5</span><span class="s2">         pre   b != 0</span>
<span class="linenos"> 6</span><span class="s2">         post  result == (a % b == 0)</span>
<span class="linenos"> 7</span><span class="s2">    }&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>    <span class="n">val</span> <span class="n">ans</span><span class="p">:</span> <span class="n">B</span>  <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">%</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 9</span>    <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">10</span><span class="p">}</span>
</pre></div>
</div>
<p>Immediately following the definition there is a proof block that contains the
precondition, post-condition, and the modifies clauses.</p>
<p>The precondition, which is optional, states the situations under which the
function operates correctly.  It generally constrains the values of the parameters
and any global variables (think C# class fields or properties) to ensure
the function operates properly.  Logika accepts both the keywords <code class="docutils literal notranslate"><span class="pre">pre</span></code> and
<code class="docutils literal notranslate"><span class="pre">requires</span></code> to start the precondition definition.  Multiple requirements may be
stated on separate lines–this allows them to be proven/used individually
in proof blocks.  Logika will throw an error if preconditions are not proven
before calling a function.</p>
<p>Next, similar to loops, if a function modifies parameters or global values,
it must list them in a <strong>modifies</strong> clause.  In addition to the loop-like features,
Logika will capture a <code class="docutils literal notranslate"><span class="pre">&lt;var_name&gt;_in</span></code> snapshot each variable listed in the
modified clause.  This facilitates comparisons between current and “original” values.
<code class="docutils literal notranslate"><span class="pre">_in</span></code> values are only captured for items listed in the modified clause.</p>
<p>Finally, the post-condition (<code class="docutils literal notranslate"><span class="pre">post</span></code> or <code class="docutils literal notranslate"><span class="pre">ensures</span></code>) states what the function has
accomplished when it terminates. Like preconditions it may contain multiple
lines.  Logika will throw an error if post-conditions are not proven
before leaving a function. Logika uses the keyword <code class="docutils literal notranslate"><span class="pre">result</span></code> to refer to the
object (if any) returned by the function. This shorthand only exists in the
proof-block following the function’s definition.</p>
<p>It is an excellent practice to discuss the “final” values of anything mentioned in
the “modifies” block, as well as “result” so users of the function understand
what the function has accomplished.</p>
<section id="specification">
<h3><span class="section-number">7.2.1. </span>Specification<a class="headerlink" href="#specification" title="Permalink to this headline">¶</a></h3>
<p>The function’s <em>specification</em> consists of its header line and pre- and post-
conditions and the modifies block.  This tells us how to use the function correctly:
(A comment with the informal description is also nice to have.)
Here is the specification for the above function:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>def divides( a: Z, b: Z) : B =  {
<span class="linenos">2</span>// Determines if a is evenly divisible by b
<span class="linenos">3</span> l&quot;&quot;&quot;{
<span class="linenos">4</span>      pre   b != 0
<span class="linenos">5</span>      post  result == (a % b == 0)
<span class="linenos">6</span> }&quot;&quot;&quot;
</pre></div>
</div>
<p>The specification tells us what we need to know to use the function correctly.
<em>The person/program who calls the function is not supposed to read the
function’s code to know how to use the function</em>.
This is especially crucial when you use a function from a library that was
written by someone else – ideally, you should not read the library’s code to
learn how to call the library’s functions!</p>
<p>In the above example, the client can tell that <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are not modified
so can deduce that the returned result does indeed check if b divides a.</p>
<aside class="sidebar">
<p class="sidebar-title">Modifies as part of contract</p>
<dl>
<dt>Consider :</dt><dd><div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>def divides( a: Z, b: Z) : B =  {
<span class="linenos">2</span>// Determines if a is evenly divisible by b
<span class="linenos">3</span> l&quot;&quot;&quot;{
<span class="linenos">4</span>      pre   b != 0
<span class="linenos">5</span>      modifies b
<span class="linenos">6</span>      post  result == (a % b == 0)
<span class="linenos">7</span> }&quot;&quot;&quot;
</pre></div>
</div>
</dd>
</dl>
<p>The client reading this specification cannot be certain that the function
is accurate.  The <code class="docutils literal notranslate"><span class="pre">b</span></code> in the <code class="docutils literal notranslate"><span class="pre">result</span> <span class="pre">==</span></code> is the final, modified
version of <code class="docutils literal notranslate"><span class="pre">b</span></code>.  There is nothing to tell the client what value <code class="docutils literal notranslate"><span class="pre">b</span></code>
holds at the end of the function.</p>
<p>If you put a variable in the modifies clause, describe its value in the post
conditions.</p>
</aside>
</section>
<section id="using-specifications">
<h3><span class="section-number">7.2.2. </span>Using Specifications<a class="headerlink" href="#using-specifications" title="Permalink to this headline">¶</a></h3>
<p>To call the function, we supply arguments that bind to the function’s parameters,
and we supply a variable that is the target for the returned answer and we
ensure any preconditions for the parameters are met.
We correctly call the function like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">divides</span><span class="p">(</span> <span class="n">a</span><span class="p">:</span> <span class="n">Z</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">B</span> <span class="o">=</span>  <span class="p">{</span>
<span class="linenos"> 4</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 5</span><span class="s2">         pre   b != 0</span>
<span class="linenos"> 6</span><span class="s2">         post  result == (a % b == 0)</span>
<span class="linenos"> 7</span><span class="s2">    }&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>    <span class="n">val</span> <span class="n">ans</span><span class="p">:</span> <span class="n">B</span>  <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">%</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 9</span>    <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">10</span><span class="p">}</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">val</span> <span class="n">x</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="linenos">13</span><span class="n">val</span> <span class="n">y</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="linenos">14</span><span class="n">assume</span> <span class="p">(</span><span class="n">y</span> <span class="o">!=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="n">val</span> <span class="n">isDiv</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="n">divides</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="k">if</span> <span class="p">(</span><span class="n">isDiv</span><span class="p">){</span>
<span class="linenos">19</span>   <span class="n">println</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot; divides &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">20</span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos">21</span>   <span class="n">println</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot; does not divide &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">22</span><span class="p">}</span>
</pre></div>
</div>
<p>To call the function, <em>we must prove the function’s precondition at the point of
call for its parameters</em>.
As our reward for establishing the precondition, we receive in return the
post-condition.</p>
<p>A proof of this is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">val</span> <span class="n">x</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="linenos"> 4</span><span class="n">val</span> <span class="n">y</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="linenos"> 5</span><span class="n">assume</span> <span class="p">(</span><span class="n">y</span> <span class="o">!=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 6</span><span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 7</span><span class="s2">    1. y != 0 premise  //  prove divides pre-condition</span>
<span class="linenos"> 8</span><span class="s2">}&quot;&quot;&quot;</span>
<span class="linenos"> 9</span><span class="n">val</span> <span class="n">isDiv</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="n">divides</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="linenos">10</span><span class="k">assert</span> <span class="p">(</span> <span class="n">isDiv</span> <span class="o">==</span> <span class="p">((</span> <span class="n">x</span> <span class="o">%</span> <span class="n">y</span>  <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">if</span> <span class="p">(</span><span class="n">isDiv</span><span class="p">){</span>
<span class="linenos">13</span>   <span class="n">println</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot; divides &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">14</span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos">15</span>   <span class="n">println</span><span class="p">(</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot; does not divide &quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">16</span><span class="p">}</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="k">def</span> <span class="nf">divides</span><span class="p">(</span> <span class="n">a</span><span class="p">:</span> <span class="n">Z</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">B</span> <span class="o">=</span>  <span class="p">{</span>
<span class="linenos">19</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">20</span><span class="s2">         pre   b != 0</span>
<span class="linenos">21</span><span class="s2">         post  result == (a % b == 0)</span>
<span class="linenos">22</span><span class="s2">    }&quot;&quot;&quot;</span>
<span class="linenos">23</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">24</span><span class="s2">        1. b != 0  premise // we assume this (use it as a premise)</span>
<span class="linenos">25</span><span class="s2">                           // because we know pre-cond must hold here</span>
<span class="linenos">26</span><span class="s2">    }&quot;&quot;&quot;</span>
<span class="linenos">27</span>
<span class="linenos">28</span>    <span class="n">val</span> <span class="n">ans</span><span class="p">:</span> <span class="n">B</span>  <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">%</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">29</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">30</span><span class="s2">        1. b != 0  premise</span>
<span class="linenos">31</span><span class="s2">        2. ans  = (a % b == 0) premise  // prove post-condition holds immediately</span>
<span class="linenos">32</span><span class="s2">                                        // before the return statement</span>
<span class="linenos">33</span><span class="s2">    }&quot;&quot;&quot;</span>
<span class="linenos">34</span>
<span class="linenos">35</span>    <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">36</span><span class="p">}</span>
</pre></div>
</div>
<p>In contrast, we cannot presume <code class="docutils literal notranslate"><span class="pre">divides</span></code>’ post-condition if we eliminate the
<code class="docutils literal notranslate"><span class="pre">assume</span> <span class="pre">(</span> <span class="pre">y</span> <span class="pre">!=</span> <span class="pre">0</span> <span class="pre">)</span></code>.  Try it and see if Logika will accept the proof.</p>
<p>Since we did not prove <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">!=</span> <span class="pre">0</span></code> as a precondition for applying <code class="docutils literal notranslate"><span class="pre">divides</span></code>,
we cannot assert the post-condition after the call.
Literally, we have no knowledge of what the function produces in this situation
– perhaps the call will “crash” (generate an exception)!</p>
<p>Let us again consider the program which calculates the real roots of the
quadratic equation.  The client’s knowledge of values and services’ contracts looks
something like this:</p>
<a class="reference internal image-reference" href="../../_images/07-image-10.png"><img alt="../../_images/07-image-10.png" src="../../_images/07-image-10.png" style="width: 833.6px; height: 333.6px;" /></a>
<p>and a call tree based on the equation for root1 is</p>
<a class="reference internal image-reference" href="../../_images/07-image-20.png"><img alt="../../_images/07-image-20.png" src="../../_images/07-image-20.png" style="width: 428.8px; height: 657.6px;" /></a>
<p>As mentioned when the program was introduced, there is a problem.  In this case,
the problem is with meeting the contract for <code class="docutils literal notranslate"><span class="pre">sqrt</span></code>.  The precondition
for <code class="docutils literal notranslate"><span class="pre">sqrt</span></code> is that its input is real and non-negative.  However, the post-condition
for <code class="docutils literal notranslate"><span class="pre">subt</span></code> does not guarantee that it’s result is positive, only that the result
is a real number.</p>
<p>Potential solutions include: adding a pre-condition to root1, requiring the discriminant
(<em>b^2 - 4ac</em>) to be positive; and, adding an if-condition which only calculates
the root if the discriminant is positive.</p>
</section>
<section id="forwards-law-for-function-definition-and-call">
<h3><span class="section-number">7.2.3. </span>Forwards Law for Function Definition and Call<a class="headerlink" href="#forwards-law-for-function-definition-and-call" title="Permalink to this headline">¶</a></h3>
<p>Here is a summary of what we have developed so far.
Given a function, <code class="docutils literal notranslate"><span class="pre">f</span></code>, with a pre-post specification, we must show that the
presumption of the precondition at the beginning of the function’s body lets us
prove the post-condition at the end of the body:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="o">&lt;</span><span class="n">x</span><span class="p">:</span><span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;&gt;</span><span class="p">):</span> <span class="n">return_type</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">       pre    Q     // where  Q  can mention  x</span>
<span class="s2">       &lt;modifies ...&gt;  // as appropriate</span>
<span class="s2">       post   R     // where  R  can mention  result and x)</span>

<span class="s2">    }&quot;&quot;&quot;</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">       1.  Q     premise // Here we know the pre-conditions hold</span>
<span class="s2">    }&quot;&quot;&quot;</span>
    <span class="n">BODY</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">          ...    // prove  R  here, that is, the return-var</span>
<span class="s2">                 // and  x  have property  R</span>
<span class="s2">    }&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="n">var_name</span><span class="o">&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Outside of the function, <code class="docutils literal notranslate"><span class="pre">f</span></code>, we write <code class="docutils literal notranslate"><span class="pre">f_pre</span></code> for <code class="docutils literal notranslate"><span class="pre">Q</span></code> and <code class="docutils literal notranslate"><span class="pre">f_post</span></code> for
<code class="docutils literal notranslate"><span class="pre">R</span></code>.
Here is the schematic for a correct call of the function.
It is a variation of the assignment law:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="s2">&quot;&quot;&quot;{ [e/x]f_pre  }&quot;&quot;&quot;</span>              <span class="o">//</span> <span class="n">prove</span> <span class="n">the</span> <span class="n">precondition</span><span class="p">,</span> <span class="n">where</span>  <span class="n">e</span>  <span class="n">binds</span> <span class="n">to</span> <span class="n">parameter</span> <span class="n">x</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>                            <span class="o">//</span> <span class="n">y</span>  <span class="n">does</span> <span class="ow">not</span> <span class="n">appear</span> <span class="ow">in</span>  <span class="n">e</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     1. [y/result][e/x]f_post   premise  // presume the post-condition,</span>
<span class="s2">                                      // where  y  gets  result&#39;s  value</span>
<span class="s2">  2. [y_old/y][e/x]f_pre  premise     // knowledge before the call is revised</span>
<span class="s2">   . . .</span>
<span class="s2"> }&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Recall that <code class="docutils literal notranslate"><span class="pre">[e/x]f_pre</span></code> defines a substitution of <code class="docutils literal notranslate"><span class="pre">e</span></code> for all occurrences
of <code class="docutils literal notranslate"><span class="pre">x</span></code> within formula <code class="docutils literal notranslate"><span class="pre">f_pre</span></code>.</p>
<p>Here is another example, an absolute-value function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">absValue</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 4</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 5</span><span class="s2">         pre    x != 0</span>
<span class="linenos"> 6</span><span class="s2">         post   result &gt; 0 ∧  (result == 0 - x ∨ result == x)</span>
<span class="linenos"> 7</span><span class="s2">   }&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>   <span class="n">var</span> <span class="n">ans</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 9</span>   <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">10</span>       <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">x</span>
<span class="linenos">11</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos">12</span>       <span class="n">ans</span> <span class="o">=</span> <span class="n">x</span>
<span class="linenos">13</span>    <span class="p">}</span>
<span class="linenos">14</span>   <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">15</span>   <span class="p">}</span>
</pre></div>
</div>
<p>The precondition is crucial to the success of the post-condition (that the answer
is positive).
We construct a proof that converts the knowledge in the precondition into the
knowledge in the post-condition:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">absValue</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 4</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 5</span><span class="s2">         pre    x != 0</span>
<span class="linenos"> 6</span><span class="s2">         post   result &gt; 0 ∧  (result ==0 - x ∨ result == x)</span>
<span class="linenos"> 7</span><span class="s2">   }&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>   <span class="n">var</span> <span class="n">ans</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 9</span>   <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">10</span>       <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">x</span>
<span class="linenos">11</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">12</span><span class="s2">            1. x &lt; 0                        premise</span>
<span class="linenos">13</span><span class="s2">            2. ans = 0 - x                  premise</span>
<span class="linenos">14</span><span class="s2">            3. ans &gt; 0                      algebra 1 2</span>
<span class="linenos">15</span><span class="s2">            4. (ans = 0 - x) ∨ (ans == x)  ∨i1 2</span>
<span class="linenos">16</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">17</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos">18</span>       <span class="n">ans</span> <span class="o">=</span> <span class="n">x</span>
<span class="linenos">19</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">20</span><span class="s2">            1. x != 0                       premise</span>
<span class="linenos">21</span><span class="s2">            2. ¬(x &lt; 0)                     premise</span>
<span class="linenos">22</span><span class="s2">            3. x &gt; 0                        algebra 1 2</span>
<span class="linenos">23</span><span class="s2">            4. ans = x                      premise</span>
<span class="linenos">24</span><span class="s2">            5. ans &gt; 0                      algebra 3 4</span>
<span class="linenos">25</span><span class="s2">            6. (ans = 0 - x) ∨ (ans == x)  ∨i2 4</span>
<span class="linenos">26</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">27</span>    <span class="p">}</span>
<span class="linenos">28</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">29</span><span class="s2">       1. ans &gt; 0                                 premise</span>
<span class="linenos">30</span><span class="s2">       2. (ans = 0 - x) ∨ (ans == x)              premise</span>
<span class="linenos">31</span><span class="s2">       3. ans &gt; 0 ∧ ((ans = 0 - x) ∨ (ans == x))  ∧i 1 2</span>
<span class="linenos">32</span><span class="s2">    }&quot;&quot;&quot;</span>
<span class="linenos">33</span>   <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">34</span>   <span class="p">}</span>
</pre></div>
</div>
<p>Now that the function is verifies, and therefore satisfies its specification,
we can call it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">absValue</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 4</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 5</span><span class="s2">         pre    x != 0</span>
<span class="linenos"> 6</span><span class="s2">         post   result &gt; 0                      // write on 2 lines so</span>
<span class="linenos"> 7</span><span class="s2">                (result ==0 - x ∨ result == x)  // we don&#39;t have to disassemble them</span>
<span class="linenos"> 8</span><span class="s2">   }&quot;&quot;&quot;</span>
<span class="linenos"> 9</span>   <span class="n">var</span> <span class="n">ans</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">10</span>   <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">11</span>       <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">x</span>
<span class="linenos">12</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">13</span><span class="s2">            1. x &lt; 0                        premise</span>
<span class="linenos">14</span><span class="s2">            2. ans = 0 - x                  premise</span>
<span class="linenos">15</span><span class="s2">            3. ans &gt; 0                      algebra 1 2</span>
<span class="linenos">16</span><span class="s2">            4. (ans = 0 - x) ∨ (ans == x)  ∨i1 2</span>
<span class="linenos">17</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">18</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos">19</span>       <span class="n">ans</span> <span class="o">=</span> <span class="n">x</span>
<span class="linenos">20</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">21</span><span class="s2">            1. x != 0                       premise</span>
<span class="linenos">22</span><span class="s2">            2. ¬(x &lt; 0)                     premise</span>
<span class="linenos">23</span><span class="s2">            3. x &gt; 0                        algebra 1 2</span>
<span class="linenos">24</span><span class="s2">            4. ans = x                      premise</span>
<span class="linenos">25</span><span class="s2">            5. ans &gt; 0                      algebra 3 4</span>
<span class="linenos">26</span><span class="s2">            6. (ans = 0 - x) ∨ (ans == x)  ∨i2 4</span>
<span class="linenos">27</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">28</span>    <span class="p">}</span>
<span class="linenos">29</span>   <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">30</span>   <span class="p">}</span>
<span class="linenos">31</span>
<span class="linenos">32</span>
<span class="linenos">33</span><span class="n">var</span> <span class="n">n</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="linenos">34</span><span class="n">var</span> <span class="n">m</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">35</span><span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">36</span>     <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">37</span><span class="s2">         1. n != 0  premise</span>
<span class="linenos">38</span><span class="s2">     }&quot;&quot;&quot;</span>
<span class="linenos">39</span>     <span class="n">m</span> <span class="o">=</span> <span class="n">absValue</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="linenos">40</span>     <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">41</span><span class="s2">        1. m &gt; 0  premise</span>
<span class="linenos">42</span><span class="s2">     }&quot;&quot;&quot;</span>
<span class="linenos">43</span><span class="p">}</span>
<span class="linenos">44</span><span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">45</span><span class="s2">     1. m &gt; 0 ∨ ¬(n!=0)  premise</span>
<span class="linenos">46</span><span class="s2">     2. {</span>
<span class="linenos">47</span><span class="s2">         3. m &gt; 0         assume</span>
<span class="linenos">48</span><span class="s2">         4. n = 0 ∨ m &gt; 0 ∨i2 3</span>
<span class="linenos">49</span><span class="s2">         }</span>
<span class="linenos">50</span><span class="s2">     5.{</span>
<span class="linenos">51</span><span class="s2">         6. ¬(n!=0)        assume</span>
<span class="linenos">52</span><span class="s2">         7. n = 0          algebra 6</span>
<span class="linenos">53</span><span class="s2">         8. n = 0 ∨ m &gt; 0 ∨i1 7</span>
<span class="linenos">54</span><span class="s2">         }</span>
<span class="linenos">55</span><span class="s2">     9. n = 0 ∨ m &gt; 0     ∨e 1 2 5</span>
<span class="linenos">56</span><span class="s2">}&quot;&quot;&quot;</span>
<span class="linenos">57</span><span class="k">assert</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">|</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Function specifications are critical to software libraries.
Every library component simply must have a specification that describes how to
connect the component into an application.
Often the specifications are written in English, but underlying the English
descriptions are the pre-post-conditions illustrated in this section.</p>
</section>
<section id="optional-section-how-to-work-from-specifications-to-code">
<h3><span class="section-number">7.2.4. </span>Optional Section: How to Work from Specifications To Code<a class="headerlink" href="#optional-section-how-to-work-from-specifications-to-code" title="Permalink to this headline">¶</a></h3>
<p>When you call a function that someone else wrote, you rely on to tell you how
the function behaves.
(In many cases, you can’t read the code, e.g., .NET components)
If you the person <em>writing</em> the function for others to use, you supply the
function’s specification.
You can calculate the specification using the laws we studied in the previous
chapter.
But better still, you should <em>start with the specification and write the
function so that it matches the specification</em>.</p>
<p>You start by stating, in English or otherwise, the function’s goal.
You study the goal and consider how to meet it; you write the code.
You take note of the requirements your function needs on its entry parameters
and global variables to reach the goal.
Finally, you apply the programming-logic laws to show that the coding matches
the specification.</p>
<p>Here is a simplistic example.
Say you must write a function that receives two numbers as inputs and selects
the maximum, or larger, of the two as the function’s output.
The specification of the function, <code class="docutils literal notranslate"><span class="pre">max</span></code>, might look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="n">Z</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 4</span> <span class="o">//</span> <span class="nb">max</span>  <span class="n">selects</span> <span class="n">the</span> <span class="n">larger</span> <span class="n">of</span>  <span class="n">x</span>  <span class="ow">and</span>  <span class="n">y</span>  <span class="ow">and</span> <span class="n">returns</span> <span class="n">it</span>
<span class="linenos"> 5</span> <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 6</span><span class="s2">        pre    ???</span>
<span class="linenos"> 7</span><span class="s2">        post   (result = x ∨ result = y) ∧ (result &gt;= x ∧ result &gt;= y)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="s2"> }&quot;&quot;&quot;</span>
<span class="linenos">10</span>
<span class="linenos">11</span> <span class="o">...</span> <span class="n">some</span> <span class="n">code</span>
<span class="linenos">12</span> <span class="p">}</span>
</pre></div>
</div>
<p>You must write the code for function max so that it meets the post-condition.
Along the way, you might require some restrictions on <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for your
solution to work.
These would be listed in the precondition.</p>
<p>The logical operators in the post-condition sometimes give us hints how to code
the function.
Here, we see that the function’s answer will be either <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code>,
suggesting that the function will use assignment commands of the form,
<code class="docutils literal notranslate"><span class="pre">ans</span> <span class="pre">=</span> <span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">ans</span> <span class="pre">=</span> <span class="pre">y</span></code>.
We also see that there is an “or” operator in the specification.
This suggests that we will require an if-command to choose which of the two
assignments to use.
Although it is not an exact science, we can move from the post-condition to this
possible coding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="n">Z</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 4</span>   <span class="o">//</span> <span class="nb">max</span>  <span class="n">selects</span> <span class="n">the</span> <span class="n">larger</span> <span class="n">of</span>  <span class="n">x</span>  <span class="ow">and</span>  <span class="n">y</span>  <span class="ow">and</span> <span class="n">returns</span> <span class="n">it</span>
<span class="linenos"> 5</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 6</span><span class="s2">          pre    ???</span>
<span class="linenos"> 7</span><span class="s2">          post   (result = x ∨ result = y) ∧ (result &gt;= x ∧ result &gt;= y)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="s2">   }&quot;&quot;&quot;</span>
<span class="linenos">10</span>   <span class="n">var</span> <span class="n">rtrn</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">11</span>   <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">12</span>       <span class="n">rtrn</span> <span class="o">=</span> <span class="n">x</span>
<span class="linenos">13</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos">14</span>       <span class="n">rtrn</span> <span class="o">=</span> <span class="n">y</span>
<span class="linenos">15</span>    <span class="p">}</span>
<span class="linenos">16</span>    <span class="k">return</span> <span class="n">rtrn</span>
<span class="linenos">17</span> <span class="p">}</span>
</pre></div>
</div>
<p>Now, we use the laws for assignments and conditionals to compute whether a
precondition is needed that places restrictions on <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> so that the
function behaves properly.
What we see here is that our coding works correctly.  No precondition is required.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="n">Z</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 4</span>   <span class="o">//</span> <span class="nb">max</span>  <span class="n">selects</span> <span class="n">the</span> <span class="n">larger</span> <span class="n">of</span>  <span class="n">x</span>  <span class="ow">and</span>  <span class="n">y</span>  <span class="ow">and</span> <span class="n">returns</span> <span class="n">it</span>
<span class="linenos"> 5</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 6</span><span class="s2">          ensures   (result = x ∨ result = y)</span>
<span class="linenos"> 7</span><span class="s2">                    (result &gt;= x ∧ result &gt;= y)</span>
<span class="linenos"> 8</span><span class="s2">   }&quot;&quot;&quot;</span>
<span class="linenos"> 9</span>   <span class="n">var</span> <span class="n">rtrn</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">10</span>   <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">11</span>       <span class="n">rtrn</span> <span class="o">=</span> <span class="n">x</span>
<span class="linenos">12</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">13</span><span class="s2">           1. x &gt;= y                 premise</span>
<span class="linenos">14</span><span class="s2">           2. rtrn = x               premise</span>
<span class="linenos">15</span><span class="s2">           3. rtrn = x ∨ rtrn = y    ∨i1 2</span>
<span class="linenos">16</span><span class="s2">           4. rtrn &gt;= x              algebra 2</span>
<span class="linenos">17</span><span class="s2">           5. rtrn &gt;= y              algebra 1 2</span>
<span class="linenos">18</span><span class="s2">           6. rtrn &gt;= x ∧ rtrn &gt;= y  ∧i 4 5</span>
<span class="linenos">19</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">20</span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos">21</span>       <span class="n">rtrn</span> <span class="o">=</span> <span class="n">y</span>
<span class="linenos">22</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">23</span><span class="s2">           1.  ¬ (x &gt;= y)            premise</span>
<span class="linenos">24</span><span class="s2">           2. rtrn = y               premise</span>
<span class="linenos">25</span><span class="s2">           3. rtrn = x ∨ rtrn = y    ∨i2 2</span>
<span class="linenos">26</span><span class="s2">           8. y &gt; x                  algebra 1</span>
<span class="linenos">27</span><span class="s2">           4. rtrn &gt;= x              algebra 2 8</span>
<span class="linenos">28</span><span class="s2">           5. rtrn &gt;= y              algebra 1 2</span>
<span class="linenos">29</span><span class="s2">           6. rtrn &gt;= x ∧ rtrn &gt;= y  ∧i 4 5</span>
<span class="linenos">30</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">31</span>    <span class="p">}</span>
<span class="linenos">32</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">33</span><span class="s2">         1. rtrn = x ∨ rtrn = y     premise</span>
<span class="linenos">34</span><span class="s2">         2. rtrn &gt;= x ∧ rtrn &gt;= y   premise</span>
<span class="linenos">35</span><span class="s2">    }&quot;&quot;&quot;</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    <span class="k">return</span> <span class="n">rtrn</span>
<span class="linenos">38</span> <span class="p">}</span>
</pre></div>
</div>
<p>Now, we have a function — a component — that others can insert into their
programs.</p>
</section>
<section id="optional-section-backwards-law-for-function-invocation">
<h3><span class="section-number">7.2.5. </span>Optional Section: Backwards Law for Function Invocation<a class="headerlink" href="#optional-section-backwards-law-for-function-invocation" title="Permalink to this headline">¶</a></h3>
<p>Here is a precise statement of how to reason backwards from a goal across a
function call.
First, given the specification,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>def f(x:?): ? = {
    l&quot;&quot;&quot;{
      requires    Q
      ensures     R
    }&quot;&quot;&quot;
</pre></div>
</div>
<p>If a call to <code class="docutils literal notranslate"><span class="pre">f</span></code> is meant to achieve a goal, <code class="docutils literal notranslate"><span class="pre">G</span></code>, we reason backwards from
<code class="docutils literal notranslate"><span class="pre">G</span></code> to its subgoal like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">      subgoal:  [e/x]f_pre  ^  ([e/x][y/ans]f_post → G)</span>
<span class="s2">     }&quot;&quot;&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="o">//</span> <span class="n">y</span>  <span class="n">does</span> <span class="ow">not</span> <span class="n">appear</span> <span class="ow">in</span> <span class="n">argument</span>  <span class="n">e</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     goal: G</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>That is, for the call, <code class="docutils literal notranslate"><span class="pre">f(e)</span></code>, to accomplish <code class="docutils literal notranslate"><span class="pre">G</span></code>, it must be the case that
<code class="docutils literal notranslate"><span class="pre">f</span></code>’s post-condition implies <code class="docutils literal notranslate"><span class="pre">G</span></code> and that we can prove <code class="docutils literal notranslate"><span class="pre">f</span></code>’s precondition
holds true (so that we can call <code class="docutils literal notranslate"><span class="pre">f</span></code>).
An example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="n">Z</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="o">//</span> <span class="nb">max</span>  <span class="n">selects</span> <span class="n">the</span> <span class="n">larger</span> <span class="n">of</span>  <span class="n">x</span>  <span class="ow">and</span>  <span class="n">y</span>  <span class="ow">and</span> <span class="n">returns</span> <span class="n">it</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">       ensures   (result = x ∨ result = y)</span>
<span class="s2">                 (result &gt;= x ∧ result &gt;= y)</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>and the program</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">a</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="n">var</span> <span class="n">b</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span>
<span class="sd">&quot;&quot;&quot;{  subgoal: ??? }&quot;&quot;&quot;</span>
<span class="n">var</span> <span class="n">c</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">recip</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;{  goal: c  &lt; 7 }&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>we compute that the subgoal is <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">7</span> <span class="pre">^</span> <span class="pre">b</span> <span class="pre">&gt;</span> <span class="pre">7</span> <span class="pre">→</span> <span class="pre">c</span> <span class="pre">&gt;</span> <span class="pre">7)</span></code>.</p>
<p>This tells us what <code class="docutils literal notranslate"><span class="pre">assert</span></code> or <code class="docutils literal notranslate"><span class="pre">if</span></code> command to add to our program:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">a</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="n">var</span> <span class="n">b</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">7</span> <span class="o">|</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>That is, if we expect the computed maximum of 2 integers to be greater than 7,
we need to ensure at least one of the integers is greater than 7.</p>
</section>
</section>
<section id="global-variables-and-procedures">
<h2><span class="section-number">7.3. </span>Global Variables and Procedures<a class="headerlink" href="#global-variables-and-procedures" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some languages, especially those derived from Pascal (ex: Ada), have
strict syntax a semantic rules governing functions and procedures–they
cannot be interchanged. In many
functional languages, functions are evaluated for their return value and
procedures for their side-effect.  Most object oriented languages are more
relaxed and you may see the terms function and procedure used interchangeably.</p>
</div>
<p>Recall we use “procedure” to refer to functions which use or change global
values.  For example, <code class="docutils literal notranslate"><span class="pre">fpm</span></code> is global to <code class="docutils literal notranslate"><span class="pre">convert2Feet</span></code> here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">var</span> <span class="n">fpm</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">5280</span>  <span class="o">//</span> <span class="n">feet</span> <span class="n">per</span> <span class="n">mile</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="n">var</span> <span class="n">miles</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="n">var</span> <span class="n">totalFeet</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 8</span><span class="k">if</span> <span class="p">(</span> <span class="n">miles</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">){</span>
<span class="linenos"> 9</span>       <span class="n">totalFeet</span> <span class="o">=</span> <span class="n">convert2Feet</span><span class="p">(</span><span class="n">miles</span><span class="p">)</span>
<span class="linenos">10</span><span class="p">}</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="k">def</span> <span class="nf">convert2Feet</span><span class="p">(</span><span class="n">m</span> <span class="p">:</span> <span class="n">Z</span><span class="p">):</span> <span class="n">Z</span> <span class="o">=</span><span class="p">{</span>
<span class="linenos">13</span>   <span class="n">val</span> <span class="n">rtrn</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">fpm</span>
<span class="linenos">14</span>   <span class="k">return</span> <span class="n">rtrn</span>
<span class="linenos">15</span><span class="p">}</span>
</pre></div>
</div>
<p>A global variable “lives” before a procedure is called and lives after the
function finishes.
In the above example, <code class="docutils literal notranslate"><span class="pre">fpm</span></code> is defined before the procedure <code class="docutils literal notranslate"><span class="pre">convert2Feet</span></code>
is called, and it exists after the procedure exits.
In contrast, <code class="docutils literal notranslate"><span class="pre">fpm</span></code> is local here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">var</span> <span class="n">miles</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="linenos"> 4</span><span class="n">var</span> <span class="n">totalFeet</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 5</span><span class="k">if</span> <span class="p">(</span> <span class="n">miles</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">){</span>
<span class="linenos"> 6</span>       <span class="n">totalFeet</span> <span class="o">=</span> <span class="n">convert2Feet</span><span class="p">(</span><span class="n">miles</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="p">}</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="k">def</span> <span class="nf">convert2Feet</span><span class="p">(</span><span class="n">m</span> <span class="p">:</span> <span class="n">Z</span><span class="p">):</span> <span class="n">Z</span> <span class="o">=</span><span class="p">{</span>
<span class="linenos">10</span>   <span class="n">var</span> <span class="n">fpm</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">5280</span>  <span class="o">//</span> <span class="n">feet</span> <span class="n">per</span> <span class="n">mile</span>
<span class="linenos">11</span>   <span class="n">val</span> <span class="n">rtrn</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">fpm</span>
<span class="linenos">12</span>   <span class="k">return</span> <span class="n">rtrn</span>
<span class="linenos">13</span><span class="p">}</span>
</pre></div>
</div>
<p>A global variable that is read (but <em>not updated</em>) by a procedure body can be
safely used in the procedure’s pre- and post-conditions;
it acts just like an extra parameter to the function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">var</span> <span class="n">fpm</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">5280</span>  <span class="o">//</span> <span class="n">feet</span> <span class="n">per</span> <span class="n">mile</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="n">var</span> <span class="n">miles</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">readInt</span><span class="p">()</span>
<span class="linenos"> 6</span><span class="n">var</span> <span class="n">totalFeet</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 7</span><span class="k">if</span> <span class="p">(</span> <span class="n">miles</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">){</span>
<span class="linenos"> 8</span>       <span class="n">totalFeet</span> <span class="o">=</span> <span class="n">convert2Feet</span><span class="p">(</span><span class="n">miles</span><span class="p">)</span>
<span class="linenos"> 9</span><span class="p">}</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="k">def</span> <span class="nf">convert2Feet</span><span class="p">(</span><span class="n">m</span> <span class="p">:</span> <span class="n">Z</span><span class="p">):</span> <span class="n">Z</span> <span class="o">=</span><span class="p">{</span>
<span class="linenos">12</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">13</span><span class="s2">       requires m &gt;= 0</span>
<span class="linenos">14</span><span class="s2">                fpm &gt; 5200</span>
<span class="linenos">15</span><span class="s2">       ensures result = m * fpm</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="s2">   }&quot;&quot;&quot;</span>
<span class="linenos">18</span>   <span class="n">val</span> <span class="n">rtrn</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">fpm</span>
<span class="linenos">19</span>   <span class="k">return</span> <span class="n">rtrn</span>
<span class="linenos">20</span><span class="p">}</span>
<span class="linenos">21</span>
</pre></div>
</div>
<p>However, we must restrict all calls to the procedure so that the call does <em>not</em> use the
global variable as the target of the function’s answer.
That is, <code class="docutils literal notranslate"><span class="pre">totalFeet</span> <span class="pre">=</span> <span class="pre">convert2Feet(5)</span></code> is ok, and so is <code class="docutils literal notranslate"><span class="pre">totalFeet</span> <span class="pre">=</span> <span class="pre">convert2Feet(fmp)</span></code>,
but <code class="docutils literal notranslate"><span class="pre">fpm</span> <span class="pre">=</span> <span class="pre">convert2Feet(5)</span></code> <em>is not</em>.</p>
<section id="global-variables-that-are-updated">
<h3><span class="section-number">7.3.1. </span>Global Variables that are Updated<a class="headerlink" href="#global-variables-that-are-updated" title="Permalink to this headline">¶</a></h3>
<p>In the Logika language, every global variable that is updated by a procedure must
be listed in the <code class="docutils literal notranslate"><span class="pre">modifies</span></code> line that is in the Logika proof-block following the
procedure’s signature.</p>
<p>Here is a simple but important example: a timer that counts down to zero.
The <code class="docutils literal notranslate"><span class="pre">init</span></code> and <code class="docutils literal notranslate"><span class="pre">tick</span></code> procedures maintain the global variable <code class="docutils literal notranslate"><span class="pre">time</span></code>.  <code class="docutils literal notranslate"><span class="pre">tick</span></code>
requires that initial time (time_in) is greater than or equal to zero; and promises that if
it is strictly greater than 0, <code class="docutils literal notranslate"><span class="pre">tick</span></code>  will decrement the time by 1.  <code class="docutils literal notranslate"><span class="pre">init</span></code>
requires that the start ticks be greater zero; and promises that
time will be set to the value provided.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>   <span class="n">var</span> <span class="n">time</span><span class="p">:</span> <span class="n">Z</span>  <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 4</span>      <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 5</span><span class="s2">        1.  time == 0     premise</span>
<span class="linenos"> 6</span><span class="s2">        2.  time &gt;= 0     algebra 1</span>
<span class="linenos"> 7</span><span class="s2">      }&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>   <span class="k">def</span> <span class="nf">tick</span><span class="p">()</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">10</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">11</span><span class="s2">         pre    time &gt;= 0</span>
<span class="linenos">12</span><span class="s2">         modifies time</span>
<span class="linenos">13</span><span class="s2">         post   time &gt;= 0</span>
<span class="linenos">14</span><span class="s2">                time_in &gt; 0 → (time = time_in -1)</span>
<span class="linenos">15</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">16</span>      <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0               premise }&quot;&quot;&quot;</span>
<span class="linenos">17</span>      <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">18</span>           <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="mi">1</span>
<span class="linenos">19</span>           <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">20</span><span class="s2">             1. time_old != 0            premise</span>
<span class="linenos">21</span><span class="s2">             2. time_old &gt;= 0            premise</span>
<span class="linenos">22</span><span class="s2">             3. time_old &gt; 0             algebra 1 2</span>
<span class="linenos">23</span><span class="s2">             4. time_old = time_in       premise</span>
<span class="linenos">24</span><span class="s2">             5. time == time_old - 1     premise</span>
<span class="linenos">25</span><span class="s2">             6. time &gt;= 0                algebra 3 5</span>
<span class="linenos">26</span><span class="s2">             7. time == time_in -1       algebra 4 5</span>
<span class="linenos">27</span><span class="s2">             8. {</span>
<span class="linenos">28</span><span class="s2">                  9. time_in &gt; 0         assume</span>
<span class="linenos">29</span><span class="s2">                  10. time == time_in -1 premise</span>
<span class="linenos">30</span><span class="s2">             }</span>
<span class="linenos">31</span><span class="s2">             11. time_in &gt; 0 → (time = time_in -1)  →i 8</span>
<span class="linenos">32</span><span class="s2">           }&quot;&quot;&quot;</span>
<span class="linenos">33</span>       <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
<span class="linenos">34</span>           <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RING RING RING&quot;</span><span class="p">)</span>
<span class="linenos">35</span>           <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">36</span><span class="s2">                 1. time = time_in       premise</span>
<span class="linenos">37</span><span class="s2">                 2.  time &gt;= 0           premise</span>
<span class="linenos">38</span><span class="s2">                 3.  ¬(time != 0)        premise</span>
<span class="linenos">39</span><span class="s2">                 4.  time == 0           algebra 3 2</span>
<span class="linenos">40</span><span class="s2">                 5. {</span>
<span class="linenos">41</span><span class="s2">                    6. time_in &gt; 0       assume</span>
<span class="linenos">42</span><span class="s2">                    7. ⊥                algebra 4 6 1</span>
<span class="linenos">43</span><span class="s2">                    8. time == time_in -1 ⊥e 7</span>
<span class="linenos">44</span><span class="s2">                    }</span>
<span class="linenos">45</span><span class="s2">                 9.  time_in &gt; 0 → (time = time_in -1)  →i 5</span>
<span class="linenos">46</span><span class="s2">           }&quot;&quot;&quot;</span>
<span class="linenos">47</span>           <span class="p">}</span>
<span class="linenos">48</span>        <span class="n">var</span> <span class="n">rtrn</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">time</span>
<span class="linenos">49</span>        <span class="k">return</span> <span class="n">rtrn</span>
<span class="linenos">50</span>    <span class="p">}</span>
<span class="linenos">51</span>
<span class="linenos">52</span>   <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">starttime</span><span class="p">:</span><span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Unit</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">53</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">54</span><span class="s2">         pre  starttime &gt; 0</span>
<span class="linenos">55</span><span class="s2">         modifies time</span>
<span class="linenos">56</span><span class="s2">         post time &gt;= 0</span>
<span class="linenos">57</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">58</span>       <span class="n">time</span> <span class="o">=</span> <span class="n">starttime</span>
<span class="linenos">59</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">60</span><span class="s2">         1.  starttime &gt; 0              premise</span>
<span class="linenos">61</span><span class="s2">         2.  time == starttime          premise</span>
<span class="linenos">62</span><span class="s2">         3.  time &gt;= 0                  algebra 1 2</span>
<span class="linenos">63</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">64</span>   <span class="p">}</span>
<span class="linenos">65</span>
<span class="linenos">66</span>
<span class="linenos">67</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">68</span><span class="s2">         1.  time &gt;= 0                   premise</span>
<span class="linenos">69</span><span class="s2">         2. 10 &gt; 0                      algebra</span>
<span class="linenos">70</span><span class="s2">         }&quot;&quot;&quot;</span>
<span class="linenos">71</span>   <span class="n">init</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos">72</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0                   premise  }&quot;&quot;&quot;</span>
<span class="linenos">73</span>   <span class="n">var</span> <span class="n">a</span><span class="p">:</span> <span class="n">Z</span>  <span class="o">=</span> <span class="n">tick</span><span class="p">()</span>
<span class="linenos">74</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0                   premise  }&quot;&quot;&quot;</span>
<span class="linenos">75</span>   <span class="n">a</span> <span class="o">=</span> <span class="n">tick</span><span class="p">()</span>
<span class="linenos">76</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0                   premise  }&quot;&quot;&quot;</span>
<span class="linenos">77</span>   <span class="n">a</span> <span class="o">=</span> <span class="n">tick</span><span class="p">()</span>
<span class="linenos">78</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0                   premise  }&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Each of the procedures can change variable <code class="docutils literal notranslate"><span class="pre">time</span></code>, and each time a function
finished, there is a post-condition that <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code>.
This is an <em>invariant</em>; here the invariant property is that <code class="docutils literal notranslate"><span class="pre">time</span></code> stays
nonnegative.</p>
<p>This next example is similar.
The procedure that withdraws money from a bank account must never let the
balance go negative:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">var</span> <span class="n">balance</span><span class="p">:</span> <span class="n">Z</span>  <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="n">howmuch</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 5</span>    <span class="o">//</span> <span class="n">withdraw</span>  <span class="n">removes</span>  <span class="n">howmuch</span>  <span class="kn">from</span>  <span class="nn">balance</span>
<span class="linenos"> 6</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 7</span><span class="s2">      pre      howmuch &gt;= 0</span>
<span class="linenos"> 8</span><span class="s2">               balance &gt;= 0</span>
<span class="linenos"> 9</span><span class="s2">      modifies balance</span>
<span class="linenos">10</span><span class="s2">      post     balance == balance_in - result   ^   balance &gt;= 0</span>
<span class="linenos">11</span><span class="s2">    }&quot;&quot;&quot;</span>
<span class="linenos">12</span>    <span class="n">var</span> <span class="n">cash</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">13</span>    <span class="k">if</span>  <span class="p">(</span><span class="n">howmuch</span> <span class="o">&lt;=</span> <span class="n">balance</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">14</span>        <span class="n">cash</span> <span class="o">=</span> <span class="n">howmuch</span>
<span class="linenos">15</span>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="linenos">16</span>        <span class="n">cash</span> <span class="o">=</span> <span class="n">balance</span>
<span class="linenos">17</span>    <span class="p">}</span>
<span class="linenos">18</span>    <span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">-</span> <span class="n">cash</span>
<span class="linenos">19</span>    <span class="k">return</span> <span class="n">cash</span>
<span class="linenos">20</span>    <span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">withdraw</span></code>’s pre- and post-conditions are carefully written to ensure that
the procedure is used correctly.
Recall that <code class="docutils literal notranslate"><span class="pre">balance_in</span></code> means the value of global variable <code class="docutils literal notranslate"><span class="pre">balance</span></code> on
procedure entry.
We will return to both these examples shortly.</p>
</section>
<section id="deduction-law-for-procedures">
<h3><span class="section-number">7.3.2. </span>Deduction Law for Procedures<a class="headerlink" href="#deduction-law-for-procedures" title="Permalink to this headline">¶</a></h3>
<p>Here is a precise statement of the law we use for procedures:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="o">...</span>   <span class="o">//</span>  <span class="n">the</span> <span class="k">global</span> <span class="n">variable</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">      pre    Q      (where assertion  Q  mentions  x and g)  This is  f_pre.</span>
<span class="s2">      modifies g, x (as applicable)</span>
<span class="s2">      post   R      (where  R  mentions  result, x, g, and g_in)   This is  f_post.</span>
<span class="s2">    }&quot;&quot;&quot;</span>
    <span class="n">BODY</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To invoke the procedure, we prove the precondition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     [e/x]f_pre</span>
<span class="s2">}&quot;&quot;&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>                             <span class="o">//</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">g</span>  <span class="n">do</span> <span class="ow">not</span> <span class="n">appear</span> <span class="ow">in</span>  <span class="n">e</span><span class="p">,</span>  <span class="ow">and</span>  <span class="n">y</span> <span class="ow">and</span> <span class="n">g</span>  <span class="n">are</span> <span class="n">distinct</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     1. [y/ans][e/x][g_old/g_in]f_post  premise</span>
<span class="s2">     2. [y_old/y][g_old/g][e/x]f_pre    premise</span>
<span class="s2">     ...</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Since global variable <code class="docutils literal notranslate"><span class="pre">g</span></code> acts as a second answer variable, <code class="docutils literal notranslate"><span class="pre">g</span></code> cannot
appear in argument <code class="docutils literal notranslate"><span class="pre">e</span></code> nor can it be the same as <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
</section>
<section id="global-variable-invariants">
<h3><span class="section-number">7.3.3. </span>Global-Variable Invariants<a class="headerlink" href="#global-variable-invariants" title="Permalink to this headline">¶</a></h3>
<p>A global variable is often shared by more than one procedure, and the procedures
must cooperate and keep the global variable in proper shape for shared use.
For this reason, a global variable often has attached to it a
<em>global-variable invariant</em> that asserts a property of the variable’s value that
must be preserved by every procedure that updates the variable.</p>
<p>Earlier, we saw a timer module that maintained a nonnegative value for <code class="docutils literal notranslate"><span class="pre">time</span></code>.
It is best to assert that <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> is a global invariant.
Then, each of the two procedures can assume the invariant when they execute.
(And, each procedure must ensure the invariant is still holding true when they
exit!)</p>
<p>Logika supports a concept of <em>global invariant</em>.  If a global value is given an
invariant (see lines 11 - 13 below), Logika will enforce that requirement
every time a function is called and when the procedure returns.  Note, you must
prove the invariant <strong>before</strong>  claiming it.</p>
<p>Here is the timer example reworked:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>   <span class="n">var</span> <span class="n">time</span><span class="p">:</span> <span class="n">Z</span>  <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 4</span>      <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 5</span><span class="s2">        1.  time == 0     premise</span>
<span class="linenos"> 6</span><span class="s2">        2.  time &gt;= 0     algebra 1</span>
<span class="linenos"> 7</span><span class="s2">      }&quot;&quot;&quot;</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>  <span class="o">//</span> <span class="n">This</span> <span class="n">invariant</span> <span class="n">will</span> <span class="n">be</span> <span class="n">checked</span> <span class="n">time</span> <span class="n">a</span> <span class="n">function</span> <span class="ow">or</span> <span class="n">procedure</span> <span class="n">exits</span>
<span class="linenos">10</span>  <span class="o">//</span> <span class="n">It</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">checked</span> <span class="k">if</span> <span class="n">the</span> <span class="n">main</span><span class="o">-</span><span class="n">body</span> <span class="n">changes</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">time</span>
<span class="linenos">11</span>  <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">12</span><span class="s2">       invariant time &gt;= 0</span>
<span class="linenos">13</span><span class="s2">  }&quot;&quot;&quot;</span>
<span class="linenos">14</span>
<span class="linenos">15</span>
<span class="linenos">16</span>   <span class="k">def</span> <span class="nf">tick</span><span class="p">()</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos">17</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">18</span><span class="s2">         requires time &gt;= 0</span>
<span class="linenos">19</span><span class="s2">         modifies time</span>
<span class="linenos">20</span><span class="s2">         ensures time_in &gt; 0 → (time = time_in -1)</span>
<span class="linenos">21</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">22</span>      <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0               premise }&quot;&quot;&quot;</span>
<span class="linenos">23</span>      <span class="k">if</span> <span class="p">(</span><span class="n">time</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">24</span>           <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="mi">1</span>
<span class="linenos">25</span>           <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">26</span><span class="s2">             1. time_old != 0            premise</span>
<span class="linenos">27</span><span class="s2">             2. time_old &gt;= 0            premise</span>
<span class="linenos">28</span><span class="s2">             3. time_old &gt; 0             algebra 1 2</span>
<span class="linenos">29</span><span class="s2">             4. time_old = time_in       premise</span>
<span class="linenos">30</span><span class="s2">             5. time == time_old - 1     premise</span>
<span class="linenos">31</span><span class="s2">             6. time &gt;= 0                algebra 3 5</span>
<span class="linenos">32</span><span class="s2">             7. time == time_in -1       algebra 4 5</span>
<span class="linenos">33</span><span class="s2">             8. {</span>
<span class="linenos">34</span><span class="s2">                  9. time_in &gt; 0         assume</span>
<span class="linenos">35</span><span class="s2">                  10. time == time_in -1 premise</span>
<span class="linenos">36</span><span class="s2">             }</span>
<span class="linenos">37</span><span class="s2">             11. time_in &gt; 0 → (time = time_in -1)  →i 8</span>
<span class="linenos">38</span><span class="s2">           }&quot;&quot;&quot;</span>
<span class="linenos">39</span>       <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
<span class="linenos">40</span>           <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RING RING RING&quot;</span><span class="p">)</span>
<span class="linenos">41</span>           <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">42</span><span class="s2">                 1. time = time_in       premise</span>
<span class="linenos">43</span><span class="s2">                 2.  time &gt;= 0           premise</span>
<span class="linenos">44</span><span class="s2">                 3.  ¬(time != 0)        premise</span>
<span class="linenos">45</span><span class="s2">                 4.  time == 0           algebra 3 2</span>
<span class="linenos">46</span><span class="s2">                 5. {</span>
<span class="linenos">47</span><span class="s2">                    6. time_in &gt; 0       assume</span>
<span class="linenos">48</span><span class="s2">                    7. ⊥                algebra 4 6 1</span>
<span class="linenos">49</span><span class="s2">                    8. time == time_in -1 ⊥e 7</span>
<span class="linenos">50</span><span class="s2">                    }</span>
<span class="linenos">51</span><span class="s2">                 9.  time_in &gt; 0 → (time = time_in -1)  →i 5</span>
<span class="linenos">52</span><span class="s2">           }&quot;&quot;&quot;</span>
<span class="linenos">53</span>           <span class="p">}</span>
<span class="linenos">54</span>        <span class="n">var</span> <span class="n">rtrn</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">time</span>
<span class="linenos">55</span>        <span class="k">return</span> <span class="n">rtrn</span>
<span class="linenos">56</span>    <span class="p">}</span>
<span class="linenos">57</span>
<span class="linenos">58</span>   <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="n">starttime</span><span class="p">:</span><span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Unit</span><span class="o">=</span><span class="p">{</span>
<span class="linenos">59</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">60</span><span class="s2">         pre  starttime &gt; 0</span>
<span class="linenos">61</span><span class="s2">         modifies time</span>
<span class="linenos">62</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">63</span>       <span class="n">time</span> <span class="o">=</span> <span class="n">starttime</span>
<span class="linenos">64</span>       <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">65</span><span class="s2">         1.  starttime &gt; 0              premise</span>
<span class="linenos">66</span><span class="s2">         2.  time == starttime          premise</span>
<span class="linenos">67</span><span class="s2">         3.  time &gt;= 0                  algebra 1 2</span>
<span class="linenos">68</span><span class="s2">       }&quot;&quot;&quot;</span>
<span class="linenos">69</span>   <span class="p">}</span>
<span class="linenos">70</span>
<span class="linenos">71</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">72</span><span class="s2">         1.  time &gt;= 0                   premise</span>
<span class="linenos">73</span><span class="s2">         2. 10 &gt; 0                      algebra</span>
<span class="linenos">74</span><span class="s2">         }&quot;&quot;&quot;</span>
<span class="linenos">75</span>   <span class="n">init</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos">76</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0                   premise  }&quot;&quot;&quot;</span>
<span class="linenos">77</span>   <span class="n">var</span> <span class="n">a</span><span class="p">:</span> <span class="n">Z</span>  <span class="o">=</span> <span class="n">tick</span><span class="p">()</span>
<span class="linenos">78</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0                   premise  }&quot;&quot;&quot;</span>
<span class="linenos">79</span>   <span class="n">a</span> <span class="o">=</span> <span class="n">tick</span><span class="p">()</span>
<span class="linenos">80</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0                   premise  }&quot;&quot;&quot;</span>
<span class="linenos">81</span>   <span class="n">a</span> <span class="o">=</span> <span class="n">tick</span><span class="p">()</span>
<span class="linenos">82</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{ 1.  time &gt;= 0                   premise  }&quot;&quot;&quot;</span>
</pre></div>
</div>
<dl class="simple">
<dt>The invariant is only enforced on function calls and returns.</dt><dd><p>If you violate the invariant in the main portion of the program, Logika will
not complain until you go to call a function.</p>
</dd>
</dl>
<p>In an object-oriented language, when a global (“class”) variable and its methods
(“functions”) are defined within a class, the global-variable invariant is called
the <em>class invariant</em>.</p>
<p>Here’s a pseudo-code example, a class that is embedded in a toy bank into which a child
inserts ten-cent coins.
(The bank is a “reactive system” that processes “coin-insertion events”!)
The class enforces its invariant – that’s its mission.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span> <span class="nc">DimesBank</span> <span class="p">{</span>   <span class="o">//</span> <span class="n">maintains</span> <span class="n">a</span> <span class="n">toy</span> <span class="n">bank</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>   <span class="o">//</span> <span class="n">Class</span> <span class="n">fields</span>
<span class="linenos"> 4</span>   <span class="n">var</span> <span class="n">dimes</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>    <span class="o">//</span> <span class="n">how</span> <span class="n">many</span> <span class="n">coins</span> <span class="n">inserted</span> <span class="n">so</span> <span class="n">far</span> <span class="n">into</span> <span class="n">the</span> <span class="n">bank</span>
<span class="linenos"> 5</span>   <span class="n">var</span> <span class="n">money</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>    <span class="o">//</span> <span class="n">how</span> <span class="n">much</span> <span class="n">the</span> <span class="n">coins</span> <span class="n">are</span> <span class="n">worth</span>
<span class="linenos"> 6</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 7</span><span class="s2">       1. money == 0           premise</span>
<span class="linenos"> 8</span><span class="s2">       2. dimes == 0           premise</span>
<span class="linenos"> 9</span><span class="s2">       3. money == dimes * 10  algebra 2 1</span>
<span class="linenos">10</span><span class="s2">   }&quot;&quot;&quot;</span>
<span class="linenos">11</span>   <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">12</span><span class="s2">        invariant money == dimes * 10</span>
<span class="linenos">13</span><span class="s2">   }&quot;&quot;&quot;</span>
<span class="linenos">14</span>   <span class="o">//</span> <span class="n">the</span> <span class="k">class</span> <span class="nc">maintains</span> <span class="n">this</span> <span class="n">invariant</span> <span class="nb">property</span><span class="p">:</span>
<span class="linenos">15</span>   <span class="o">//</span>   <span class="n">the</span> <span class="n">handler</span> <span class="n">method</span> <span class="n">below</span> <span class="n">can</span> <span class="n">assume</span> <span class="n">the</span> <span class="n">invariant</span> <span class="n">on</span> <span class="n">entry</span><span class="p">,</span>
<span class="linenos">16</span>   <span class="o">//</span>   <span class="ow">and</span> <span class="n">the</span> <span class="n">method</span> <span class="n">must</span> <span class="n">ensure</span> <span class="n">that</span> <span class="n">the</span> <span class="n">invariant</span> <span class="n">holds</span> <span class="n">on</span> <span class="n">exit</span>
<span class="linenos">17</span>
<span class="linenos">18</span>      <span class="k">def</span> <span class="nf">handleCoinInsertion</span><span class="p">(</span><span class="n">howmany</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Unit</span> <span class="o">=</span><span class="p">{</span>
<span class="linenos">19</span>          <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">20</span><span class="s2">              pre  howmany &gt;= 0</span>
<span class="linenos">21</span><span class="s2">              modifies money, dimes</span>
<span class="linenos">22</span><span class="s2">          }&quot;&quot;&quot;</span>
<span class="linenos">23</span>          <span class="o">///</span> <span class="n">we</span> <span class="n">introduce</span> <span class="n">the</span> <span class="n">invariant</span> <span class="k">as</span> <span class="n">a</span> <span class="n">premise</span> <span class="n">when</span> <span class="n">needed</span><span class="p">:</span>
<span class="linenos">24</span>          <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">25</span><span class="s2">              1.  money == dimes * 10                     premise</span>
<span class="linenos">26</span><span class="s2">          }&quot;&quot;&quot;</span>
<span class="linenos">27</span>          <span class="n">dimes</span> <span class="o">=</span> <span class="n">dimes</span> <span class="o">+</span> <span class="n">howmany</span>
<span class="linenos">28</span>          <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">29</span><span class="s2">              1.  money == dimes_in * 10                    premise</span>
<span class="linenos">30</span><span class="s2">              2.  dimes == dimes_in + howmany                premise</span>
<span class="linenos">31</span><span class="s2">              3.  money + (howmany * 10) == dimes * 10       algebra  1 2</span>
<span class="linenos">32</span><span class="s2">          }&quot;&quot;&quot;</span>
<span class="linenos">33</span>          <span class="o">//</span> <span class="n">the</span> <span class="n">invariant</span> <span class="ow">is</span> <span class="n">broken</span> <span class="n">here</span><span class="p">,</span> <span class="n">but</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">command</span> <span class="n">restores</span> <span class="n">it</span><span class="p">:</span>
<span class="linenos">34</span>          <span class="n">money</span> <span class="o">=</span> <span class="n">money</span> <span class="o">+</span> <span class="p">(</span><span class="n">howmany</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
<span class="linenos">35</span>          <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">36</span><span class="s2">              1.  money_in + (howmany * 10) == dimes * 10   premise</span>
<span class="linenos">37</span><span class="s2">              2.  money == money_in + (howmany * 10)         premise</span>
<span class="linenos">38</span><span class="s2">              3.  money == dimes * 10                        algebra 2 1</span>
<span class="linenos">39</span><span class="s2">          }&quot;&quot;&quot;</span>
<span class="linenos">40</span>      <span class="p">}</span> <span class="o">///</span> <span class="n">end</span> <span class="n">method</span> 
<span class="linenos">41</span>  <span class="p">}</span> <span class="o">//</span> <span class="n">END</span> <span class="n">CLASS</span>
</pre></div>
</div>
<p><em>When you code a class, first decide on the class’s fields (its “attributes”)
and write down the class invariant</em>.
Then, define and code the functions so that they maintain the invariant.</p>
<p>Here is a second example, a class that models a bank account.
The account’s balance should always be kept nonnegative:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">org.sireum.logika._</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="o">//</span> <span class="n">Class</span> <span class="n">Bank</span> <span class="n">Account</span>
<span class="linenos"> 4</span>    <span class="o">//</span> <span class="n">The</span> <span class="k">global</span> <span class="n">variable</span><span class="p">,</span> <span class="n">the</span> <span class="n">money</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">bank</span> <span class="n">balance</span><span class="p">:</span>
<span class="linenos"> 5</span>    <span class="n">var</span> <span class="n">balance</span><span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 6</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos"> 7</span><span class="s2">         1.  balance == 0       premise</span>
<span class="linenos"> 8</span><span class="s2">         2.  balance &gt;= 0       algebra 1</span>
<span class="linenos"> 9</span><span class="s2">    }&quot;&quot;&quot;</span>
<span class="linenos">10</span>    <span class="o">//</span> <span class="n">the</span> <span class="k">global</span> <span class="n">invariant</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">12</span><span class="s2">         invariant balance &gt;= 0           // this property is currently true, and</span>
<span class="linenos">13</span><span class="s2">    }&quot;&quot;&quot;</span>                                 <span class="o">//</span>  <span class="n">we</span> <span class="n">want</span> <span class="n">the</span> <span class="n">methods</span> <span class="n">to</span> <span class="n">preserve</span> <span class="n">it</span>
<span class="linenos">14</span> 
<span class="linenos">15</span>    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">howmuch</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Unit</span> <span class="o">=</span><span class="p">{</span>
<span class="linenos">16</span>        <span class="o">//</span><span class="n">deposit</span> <span class="n">adds</span>  <span class="n">howmuch</span>  <span class="n">to</span>  <span class="n">balance</span>
<span class="linenos">17</span>        <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">18</span><span class="s2">            pre   howmuch &gt;= 0</span>
<span class="linenos">19</span><span class="s2">            modifies balance</span>
<span class="linenos">20</span><span class="s2">            post  balance == balance_in + howmuch</span>
<span class="linenos">21</span><span class="s2">        }&quot;&quot;&quot;</span>
<span class="linenos">22</span>        <span class="o">//</span> <span class="n">balance_in</span>  <span class="ow">is</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">balance</span> <span class="n">when</span> <span class="n">the</span> <span class="n">method</span> <span class="n">was</span> <span class="n">entered</span>
<span class="linenos">23</span>
<span class="linenos">24</span>        <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">25</span><span class="s2">          1.  balance &gt;= 0                                        premise  // the globalinv holds on entry</span>
<span class="linenos">26</span><span class="s2">          2.  howmuch &gt;= 0                                        premise  // the precondition</span>
<span class="linenos">27</span><span class="s2">          3.  balance == balance_in                               premise  // the value of balance on entry</span>
<span class="linenos">28</span><span class="s2">        }&quot;&quot;&quot;</span>
<span class="linenos">29</span>        <span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">+</span> <span class="n">howmuch</span>
<span class="linenos">30</span>        <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">31</span><span class="s2">          1. balance == balance_old + howmuch                   premise</span>
<span class="linenos">32</span><span class="s2">          2. balance_old &gt;= 0                                   premise</span>
<span class="linenos">33</span><span class="s2">          3. howmuch &gt;= 0                                       premise</span>
<span class="linenos">34</span><span class="s2">          4. balance_old == balance_in                          premise</span>
<span class="linenos">35</span><span class="s2">          5. balance == balance_in + howmuch                    algebra 4 1</span>
<span class="linenos">36</span><span class="s2">          6. balance &gt;= 0                                       algebra 1 2 3</span>
<span class="linenos">37</span><span class="s2">        }&quot;&quot;&quot;</span>
<span class="linenos">38</span>        <span class="o">//</span> <span class="n">The</span> <span class="n">last</span> <span class="n">line</span> <span class="n">asserts</span> <span class="n">that</span> <span class="n">the</span> <span class="k">global</span> <span class="n">invariant</span> <span class="ow">is</span> <span class="n">preserved</span>
<span class="linenos">39</span>        <span class="o">//</span> <span class="n">at</span> <span class="n">the</span> <span class="n">exit</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">postcondition</span> <span class="ow">is</span> <span class="n">proved</span><span class="p">,</span> <span class="n">too</span><span class="o">.</span>
<span class="linenos">40</span>    <span class="p">}</span>
<span class="linenos">41</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="n">howmuch</span><span class="p">:</span> <span class="n">Z</span><span class="p">)</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span><span class="p">{</span>
<span class="linenos">44</span>        <span class="o">//</span> <span class="n">withdraw</span>  <span class="n">removes</span>  <span class="n">howmuch</span>  <span class="kn">from</span>  <span class="nn">balance</span>
<span class="linenos">45</span>        <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">46</span><span class="s2">             pre    howmuch &gt;= 0</span>
<span class="linenos">47</span><span class="s2">             modifies balance</span>
<span class="linenos">48</span><span class="s2">             post   balance == balance_in - result</span>
<span class="linenos">49</span><span class="s2">        }&quot;&quot;&quot;</span>
<span class="linenos">50</span>        <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">51</span><span class="s2">          1.  balance &gt;= 0                                         premise  // the globalinv holds on entry</span>
<span class="linenos">52</span><span class="s2">          2.  howmuch &gt;= 0                                         premise  // the precondition</span>
<span class="linenos">53</span><span class="s2">          3.  balance == balance_in                                premise  // the value of balance on entry</span>
<span class="linenos">54</span><span class="s2">        }&quot;&quot;&quot;</span>
<span class="linenos">55</span>        <span class="n">var</span> <span class="n">cash</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">56</span>
<span class="linenos">57</span>        <span class="k">if</span>  <span class="p">(</span><span class="n">howmuch</span> <span class="o">&lt;=</span> <span class="n">balance</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">58</span>
<span class="linenos">59</span>            <span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">-</span> <span class="n">howmuch</span>
<span class="linenos">60</span>            <span class="n">cash</span> <span class="o">=</span> <span class="n">howmuch</span>
<span class="linenos">61</span>            <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">62</span><span class="s2">                 // prove here  balance == balance_in + cash  and  balance &gt;= 0</span>
<span class="linenos">63</span><span class="s2">             }&quot;&quot;&quot;</span>
<span class="linenos">64</span>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="linenos">65</span>            <span class="n">cash</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">66</span>            <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">67</span><span class="s2">                // prove here  balance == balance_in + cash  and  balance &gt;= 0</span>
<span class="linenos">68</span><span class="s2">            }&quot;&quot;&quot;</span>
<span class="linenos">69</span>        <span class="p">}</span>
<span class="linenos">70</span>        <span class="k">return</span> <span class="n">cash</span>
<span class="linenos">71</span>        <span class="p">}</span>
<span class="linenos">72</span> 
<span class="linenos">73</span>    <span class="k">def</span> <span class="nf">getBalance</span><span class="p">()</span> <span class="p">:</span> <span class="n">Z</span> <span class="o">=</span><span class="p">{</span>
<span class="linenos">74</span>        <span class="o">//</span> <span class="n">getBalance</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">current</span> <span class="n">balance</span>
<span class="linenos">75</span>        <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">76</span><span class="s2">             post result == balance</span>
<span class="linenos">77</span><span class="s2">        }&quot;&quot;&quot;</span>
<span class="linenos">78</span>        <span class="n">var</span> <span class="n">ans</span><span class="p">:</span> <span class="n">Z</span>  <span class="o">=</span> <span class="n">balance</span>
<span class="linenos">79</span>        <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="linenos">80</span><span class="s2">             1. ans == balance                                     premise</span>
<span class="linenos">81</span><span class="s2">        }&quot;&quot;&quot;</span>
<span class="linenos">82</span>        <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">83</span>     <span class="p">}</span>
</pre></div>
</div>
<p>All the class’s functions pledge to keep <code class="docutils literal notranslate"><span class="pre">balance</span></code> nonnegative.
Assuming that no other program commands update the <code class="docutils literal notranslate"><span class="pre">balance</span></code>, the proofs
must ensure that <code class="docutils literal notranslate"><span class="pre">balance</span></code>’s global invariant holds always.</p>
<p>Whenever a module or class holds a data structure, there
<em>always should be a global invariant that states the critical properties of the
structure that must be maintained</em>.
The procedures that maintain the data structure pledge to preserve its invariant.</p>
<p>This is the technique used in modular and object-oriented programming, where
a data structure, its global invariant, and the data structure’s maintenance
procedures/functions are placed together.
Since only the maintenance procedures update the global variable and preserve
the invariant, the rest of the program can always rely on the global invariant
to hold true
<em>Without this convention, it is impossible to do component-based programming.</em></p>
<section id="law-for-global-invariants-and-procedure-calls">
<h4>Law for Global Invariants and Procedure Calls<a class="headerlink" href="#law-for-global-invariants-and-procedure-calls" title="Permalink to this headline">¶</a></h4>
<p>Here is the law used in the above example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="o">...</span>   <span class="c1"># the global variable</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     // some proof of I_g</span>
<span class="s2">}&quot;&quot;&quot;</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">    invariant  I_g</span>
<span class="s2">}&quot;&quot;&quot;</span>  <span class="c1"># must be proved true here</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">        pre    Q  (where assertion  Q  mentions  x and g)   This is  f_pre.</span>
<span class="s2">        modifies g, x (as applicable)</span>
<span class="s2">        post   R  (where  R  mentions  result, x, g, and  g_in)   This is  f_post.</span>
<span class="s2">    }&quot;&quot;&quot;</span>

    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">         1. Q      premise</span>
<span class="s2">         2. I_g    premise</span>
<span class="s2">         ...</span>
<span class="s2">    }&quot;&quot;&quot;</span>
    <span class="n">BODY</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">         prove R</span>
<span class="s2">         prove I_g</span>
<span class="s2">     }&quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For the procedure’s invocation, we deduce <code class="docutils literal notranslate"><span class="pre">[e/x]pre_f</span></code> to get the result.
Since global variable <code class="docutils literal notranslate"><span class="pre">g</span></code> acts as a second answer variable, <code class="docutils literal notranslate"><span class="pre">g</span></code> cannot
appear in argument <code class="docutils literal notranslate"><span class="pre">e</span></code> nor can it be the same as <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     [e/x]pre_f  // that is,  Q_e,g</span>
<span class="s2">}&quot;&quot;&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>   <span class="o">//</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">g</span>  <span class="n">do</span> <span class="ow">not</span> <span class="n">appear</span> <span class="ow">in</span>  <span class="n">e</span><span class="p">,</span>  <span class="ow">and</span>  <span class="n">y</span> <span class="ow">and</span> <span class="n">g</span>  <span class="n">are</span> <span class="n">distinct</span> <span class="n">names</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     1. [y/ans][e/x][g_old/g_in]f_post      premise</span>
<span class="s2">     2. [y_old/y][g_old/g][e/x]f_pre        premise</span>
<span class="s2">     3. I_g                                 globalinv</span>
<span class="s2">     ...</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Further, provided that all assignments to global variable <code class="docutils literal notranslate"><span class="pre">g</span></code> occur only
within procedures that preserve its <code class="docutils literal notranslate"><span class="pre">I_g</span></code>, we can always assert <code class="docutils literal notranslate"><span class="pre">I_g</span></code> as
needed in the main program.</p>
<p>There are many other examples of modules/classes that use global invariants.
Here are three obvious ones:</p>
<ul class="simple">
<li><p>A spreadsheet program: a module holds a grid that models a spreadsheet, and
the key invariant property is that the last cell in each row of the
spreadsheet holds the sum of the numbers in that row.
So, the functions that insert or change numbers in the cells of the
spreadsheet must compute new totals for the rows so that the invariant is
preserved.</p></li>
<li><p>A board game, like chess: a module holds a grid that models the chess board
and the pieces placed on it.
The global invariant is that the pieces correctly show the history of the
moves made so far during the game.
The functions that make moves and captures must preserve the invariant.</p></li>
<li><p>An animation: a module holds a three-dimensional space inhabited by one or
more sprites (moving objects).
The invariant is that no sprite can travel outside the dimensions of the
space.
The functions that insert, move, and delete sprites must preserve the
invariant.</p></li>
</ul>
<p><em>A key job when doing object-oriented programming is writing class invariants</em>,
that is, global invariants for the private fields in each class.
When you design a class, define the fields (data structures) and their
invariants before you write the functions that maintain the data structures and
preserve the invariants.</p>
</section>
</section>
</section>
<section id="functions-that-call-functions">
<h2><span class="section-number">7.4. </span>Functions that Call Functions<a class="headerlink" href="#functions-that-call-functions" title="Permalink to this headline">¶</a></h2>
<p>All the techniques apply when the code inside a procedure body calls another
procedure: as long as we establish the precondition for the called procedure,
we can call it, and we obtain the post-condition as new knowledge in return.
In this way, procedures can build on each others’ post-conditions.</p>
<section id="functions-that-call-themselves">
<h3><span class="section-number">7.4.1. </span>Functions that Call Themselves<a class="headerlink" href="#functions-that-call-themselves" title="Permalink to this headline">¶</a></h3>
<p>It is interesting that a procedure can call <em>itself</em>, and we can reason about
this in the same way that we use for any other procedure call.
Here is a detailed example.</p>
<p>For integer <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>, the <em>factorial</em> of <code class="docutils literal notranslate"><span class="pre">n</span></code>, written <code class="docutils literal notranslate"><span class="pre">n!</span></code> is defined as
<code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">3</span> <span class="pre">*</span> <span class="pre">...up</span> <span class="pre">to...</span> <span class="pre">*</span> <span class="pre">n</span></code>.
It is the tradition to define <code class="docutils literal notranslate"><span class="pre">0!</span> <span class="pre">=</span> <span class="pre">1</span></code>, but factorials for negative integers
do not exist.</p>
<p>Factorial lists the number of permutations (combinations or “shuffles”), e.g.,
<code class="docutils literal notranslate"><span class="pre">fact(3)</span> <span class="pre">=</span> <span class="pre">6</span></code> notes there six permutations for arranging three items,
<code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and <code class="docutils literal notranslate"><span class="pre">c</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abc</span>
<span class="n">bac</span>
<span class="n">bca</span>
<span class="n">acb</span>
<span class="n">cab</span>
<span class="n">cba</span>
</pre></div>
</div>
<p>There is a profound recursive definition of factorial:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>0! == 1
n! == (n-1)! * n,   for  n &gt; 0
</pre></div>
</div>
<p>For example, we calculate <code class="docutils literal notranslate"><span class="pre">4!</span></code> like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>4! == 3! * 4
   where 3! == 2! * 3
            where 2! == 1! * 2
                     where 1! == 0! * 1
                              where 0! == 1
So...
   0! == 1
   1! == 0! * 1 = 1
   2! == 1! * 2 = 2
   3! == 2! * 3 = 6
and finally,
   4! == 3! * 4 = 24
</pre></div>
</div>
<p>The process of counting downwards from <code class="docutils literal notranslate"><span class="pre">4!</span></code> to <code class="docutils literal notranslate"><span class="pre">3!</span></code> to <code class="docutils literal notranslate"><span class="pre">2!</span></code> to <code class="docutils literal notranslate"><span class="pre">1!</span></code> to
<code class="docutils literal notranslate"><span class="pre">0!</span></code> and assembling the answer as <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">*</span> <span class="pre">1</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">*</span> <span class="pre">3</span> <span class="pre">*</span> <span class="pre">4</span></code> can be programmed as a
function that repeatedly calls <em>itself</em> for the answers to <code class="docutils literal notranslate"><span class="pre">3!</span></code>, <code class="docutils literal notranslate"><span class="pre">2!</span></code>,
<code class="docutils literal notranslate"><span class="pre">1!</span></code>, etc.:</p>
<p>The easiest way to understand the computation of, say, <code class="docutils literal notranslate"><span class="pre">factorialRec(3)</span></code>, is to draw
out the function calls, making a new copy of the called function each time it is
restarted, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
              <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span> <span class="p">:</span>
              <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
              <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>
            <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>Notice how the <em>binding</em> of argument <code class="docutils literal notranslate"><span class="pre">3</span></code> to parameter <code class="docutils literal notranslate"><span class="pre">n</span></code> is enacted with
the assignment, <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">3</span></code>.
(This is how it is implemented within a computer, too.)
The code for <code class="docutils literal notranslate"><span class="pre">factorialRec(3)</span></code> activates a fresh copy of <code class="docutils literal notranslate"><span class="pre">factorialRec</span></code> with argument 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
                   <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
                                          <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                   <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>               <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span>
                   <span class="k">return</span> <span class="n">ans</span>             <span class="k">else</span> <span class="p">:</span>
                                             <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                                             <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>
                                          <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>This generates another call (fresh copy of) factorialRec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
                   <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
                   <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>             <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
                                                                  <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                   <span class="k">return</span> <span class="n">ans</span>              <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">2</span>               <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span>
                                           <span class="k">return</span> <span class="n">ans</span>             <span class="k">else</span> <span class="p">:</span>
                                                                     <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                                                                     <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>
                                                                  <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>This expands to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
                   <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
                   <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>             <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
                   <span class="k">return</span> <span class="n">ans</span>              <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>            <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
                                                                                          <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                                           <span class="k">return</span> <span class="n">ans</span>             <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>               <span class="n">ans</span> <span class="o">=</span> <span class="mi">1</span>
                                                                  <span class="k">return</span> <span class="n">ans</span>              <span class="k">else</span> <span class="p">:</span>
                                                                                             <span class="o">.</span> <span class="o">.</span> <span class="o">.</span>
                                                                                          <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>We see a sequence, or “stack”, of activations of <code class="docutils literal notranslate"><span class="pre">factorialRec</span></code>, one per call.
Within a computer, an <em>activation-record stack</em> remembers the activations.
The call to <code class="docutils literal notranslate"><span class="pre">factorialRec(0)</span></code> returns an answer – 1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
                   <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
                   <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>             <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
                   <span class="k">return</span> <span class="n">ans</span>              <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>            <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">return</span> <span class="mi">1</span>
                                           <span class="k">return</span> <span class="n">ans</span>             <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>
                                                                  <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>This makes the most recent activation (copy) of <code class="docutils literal notranslate"><span class="pre">factorialRec</span></code> disappear, and the
returned answer is assigned to <code class="docutils literal notranslate"><span class="pre">ans</span></code> in the previous call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
                   <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
                   <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">3</span>             <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
                   <span class="k">return</span> <span class="n">ans</span>              <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">2</span>            <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
                                           <span class="k">return</span> <span class="n">ans</span>             <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>
                                                                  <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>allowing the previous call to return <em>its</em> answer to <em>its</em> caller:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
                   <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
                   <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">3</span>             <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">return</span> <span class="mi">1</span>
                   <span class="k">return</span> <span class="n">ans</span>              <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="mi">2</span>
                                           <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>You see the pattern – the calls are finishing in reverse order, returning the
partial answers, <code class="docutils literal notranslate"><span class="pre">fact(0)</span> <span class="pre">=</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">fact(1)</span> <span class="pre">=</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">fact(2)</span> <span class="pre">=</span> <span class="pre">2</span></code>, and so on:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
                   <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
                   <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>              <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
                   <span class="k">return</span> <span class="n">ans</span>               <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>
                                            <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>and then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
           <span class="n">a</span> <span class="o">=</span> <span class="n">factorialRec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="k">return</span> <span class="mi">2</span>
           <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>
           <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
           <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
           <span class="n">ans</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">n</span>
           <span class="k">return</span> <span class="n">ans</span>
</pre></div>
</div>
<p>and finally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factorialRec</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">return</span> <span class="mi">6</span>
</pre></div>
</div>
<p>Within the computer, the code for <code class="docutils literal notranslate"><span class="pre">factorialRec</span></code> is not copied at each call –
instead, a new <em>namespace</em> (activation record) is generated for each call to
<code class="docutils literal notranslate"><span class="pre">factorialRec</span></code>.
When a call finishes, its answer is returned and its namespace is erased
(popped from the activation stack).</p>
<p>Every function has its own pre- and post- conditions.
So, if a function calls itself, it can use <em>its own pre- and post-conditions to
deduce the properties of the answer computed by the self-call</em>.
This is remarkable and exactly correct.</p>
<p>Here is the desired specification of factorialRec:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">   fact // axioms</span>
<span class="s2">     def f(n: Z): Z</span>
<span class="s2">     fZero. f(0) == 1</span>
<span class="s2">     fPos.  ∀x: Z  x &gt; 0 → f(x) == f(x - 1) * x</span>
<span class="s2"> }&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">factorialRec</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="n">Z</span><span class="p">):</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">{</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{ requires n ≥ 0</span>
<span class="s2">      ensures  result == f(n)</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">factorialRec</span></code> calls itself, we use the above pre- and post-conditions to deduce
what happens.
In the process, we deduce that the completed coding of <code class="docutils literal notranslate"><span class="pre">factorialRec</span></code> possesses
exactly these same pre- and post-conditions!</p>
<p>Recall again the “official definition” of <code class="docutils literal notranslate"><span class="pre">n!</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>0! == 1
n! == (n-1)! * n,  for  n &gt; 0
</pre></div>
</div>
<p>Here is the deduction that <code class="docutils literal notranslate"><span class="pre">factorialRec</span></code> meets its stated pre- and post-conditions:</p>
<p>We did it!
The proof is not magic or trickery – notice that the call, <code class="docutils literal notranslate"><span class="pre">factorialRec(n</span> <span class="pre">-</span> <span class="pre">1)</span></code>,
uses an argument value that is different — one smaller than — argument <code class="docutils literal notranslate"><span class="pre">n</span></code>
used with <code class="docutils literal notranslate"><span class="pre">factorialRec(n)</span></code>.
This style of recursion by counting-downward-by-ones-until-zero will be exposed
in the next chapter as an instance of <em>mathematical induction</em>.</p>
</section>
</section>
<section id="industry-applications">
<h2><span class="section-number">7.5. </span>Industry Applications<a class="headerlink" href="#industry-applications" title="Permalink to this headline">¶</a></h2>
<p>The material you have studied in this class has several applications in the contemporary
industrial practices of software and programming language design.</p>
<section id="software-design-design-by-contract">
<h3><span class="section-number">7.5.1. </span>Software Design: Design-by-Contract<a class="headerlink" href="#software-design-design-by-contract" title="Permalink to this headline">¶</a></h3>
<p>In 1986, Bertrand Myer introduced the contract as metaphor for software design,
with particular application to the then novel object-oriented programming
languages available and under development <em>(see “Applying Design by Contract”,
Bertrand Meyer, Computer, IEEE 1992–available for free if logged on from the
.ksu.edu domain)</em>.  The key idea is the both the client and
the service derive benefits from the “contractual” obligations expressed
by pre-conditions, post-conditions and invariants.</p>
<a class="reference internal image-reference" href="../../_images/07-image-30.png"><img alt="../../_images/07-image-30.png" src="../../_images/07-image-30.png" style="width: 649.0px; height: 293.5px;" /></a>
<p>While a rigorous, formal use of design-by-Contract may only be seen in high-assurance
system applications, the general practice of conceptualizing pre and post-conditions
is a benefit during design.</p>
</section>
<section id="language-implementation">
<h3><span class="section-number">7.5.2. </span>Language Implementation<a class="headerlink" href="#language-implementation" title="Permalink to this headline">¶</a></h3>
<p>If industry is using a design-by-contract, we need programming languages which
support it.  Optimally, we would like contracts to be enforced by the complier or
interpreter.</p>
<section id="type-systems">
<h4>Type Systems<a class="headerlink" href="#type-systems" title="Permalink to this headline">¶</a></h4>
<p>Statically typed languages (C# and Java) enforce a kind of contract at compilation
time. Dynamically typed languages (python and javascript), type contracts
are not checked before execution and this can lead to run time errors, or the
need for guard code to ensure “type correctness”.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// C# - static this program will never run
char[] a = { &#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;};
char b = &#39;z&#39;;
char c = a[b];  // this line will throw a compile error for type

// python - dynamic this program will run but with errors
a = [ &#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;]
b = &#39;z&#39;
c = a[b];  // this line will throw interpreter error at run time

// python with guard code (Defensive programming)
a = [ &#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;]
b = &#39;z&#39;
if (isinstance(b, int)):
   c = a[b]; // runs but we don&#39;t know if &#39;c&#39; got a value
</pre></div>
</div>
<p>Static type checking aids in soundness checking, but implementation does not
guarantee that no runtime errors will occur.  Consider this C# program</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>public class Program {
<span class="linenos">2</span>    public static void Main(string[] agrs){
<span class="linenos">3</span>      string[] a = {&quot;a&quot;,&quot;b&quot;,&quot;c&quot;};
<span class="linenos">4</span>      Foo(a)
<span class="linenos">5</span>    }
<span class="linenos">6</span>    private static void Foo(object[] a){
<span class="linenos">7</span>        a[0] = 1
<span class="linenos">8</span>    }
<span class="linenos">9</span>}
</pre></div>
</div>
<p>This program compiles but throws a run type error.  Since a <em>string[]</em> is an
<em>object[]</em>, the program compiles.  However, the assignment on line 7 in Foo
requires that the array be of a type into which the integer literal “1” can be
implicitly coerced (int, double, etc.).  Both inheritance and implicit coercion,
the practice of allowing
more precise types to “automatically convert” less precise types on assignment,
complicate reasoning about a program. So even for enforcing type-contracts,
type checking systems may not be sufficient.</p>
</section>
<section id="note-on-defensive-programming">
<h4>Note on Defensive Programming<a class="headerlink" href="#note-on-defensive-programming" title="Permalink to this headline">¶</a></h4>
<p>Preconditions, post-conditions and invariants can all be “implemented” by a bunch of
defensive coding. Services can check incoming global values and parameters,
returning a sentinel value (or throwing an exception) if something does not pass.
Clients can do the same to handle returns.  This process has several disadvantages:
it leads to code-bloat; it leads to bigger executables (compile time checks do
not necessarily lead to bigger executables); bigger executables may lead to slower
overall executions; and, the program is not very modular as a change in a service may
lead to changing the defensive programming everywhere the service is called.</p>
</section>
<section id="beyond-type-and-defensive-programming">
<h4>Beyond Type and Defensive Programming<a class="headerlink" href="#beyond-type-and-defensive-programming" title="Permalink to this headline">¶</a></h4>
<aside class="sidebar">
<p class="sidebar-title">First Class Citizen</p>
<dl class="simple">
<dt>A first class citizen in programming languages are items which</dt><dd><ol class="arabic simple">
<li><p>can be the actual parameters of functions</p></li>
<li><p>can be returned as results of functions</p></li>
<li><p>can be the subject of assignment statements</p></li>
<li><p>can be tested for equality.</p></li>
</ol>
</dd>
</dl>
<p>So in C#, literals, ints, doubles, objects  etc.  are first class citizens.
Functions are not (delegate are a way of achieving some first-class-like
functionality but fail the equality test).</p>
<p>This notion of first class citizenship comes from Dr Robin Popplestone (
<em>The Design Philosophy of POP-2. in: D. Michie: Machine Intelligence 3,
Edinburgh at the University Press, 1968</em>).</p>
</aside>
<p>Design-by-contract would benefit from a more robust set of capabilities.  Optimally the compiler
would support pre- and post-conditions, invariants and quantifiers.  There is at least
one language, Eiffel, which has contracts as a first class citizens.  <em>Ada 2012</em>
contains support for all these capabilities.</p>
<p>There are many more languages with library/environment extensions to at least minimally
support the notions of pre- and post-conditions: C#, Java, Ruby and Javascript.
A non-scientific survey the “state of the art, 2018” of design-by-contract support may
be found on the LeadingAgile (a process consultant company) web site
<a class="reference external" href="https://www.leadingagile.com/2018/05/design-by-contract-part-one/">https://www.leadingagile.com/2018/05/design-by-contract-part-one/</a></p>
</section>
</section>
</section>
<section id="summary">
<h2><span class="section-number">7.6. </span>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>We used a variety of laws for function definitions and calls.</p>
<ol class="arabic">
<li><p>Here is the simplest version, a forwards law where there is no updating to
global variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">         pre    Q    (where assertion  Q  can mention  x)   Call this,  f_pre.</span>
<span class="s2">         modifies ... (where parameters and globals are listed if modified)</span>
<span class="s2">         post   R    (where assertion  R  can mention  result and x)  Call this,  f_post.</span>
<span class="s2">    } &quot;&quot;&quot;</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">        1.  Q     premise</span>
<span class="s2">    }&quot;&quot;&quot;</span>
     <span class="n">BODY</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">         ... prove  R  here, that is,  result  and  x  have property  R</span>
<span class="s2">    }&quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Outside of the function, <code class="docutils literal notranslate"><span class="pre">f</span></code>, we write <code class="docutils literal notranslate"><span class="pre">f_pre</span></code> for <code class="docutils literal notranslate"><span class="pre">Q</span></code> and <code class="docutils literal notranslate"><span class="pre">f_post</span></code>
for <code class="docutils literal notranslate"><span class="pre">R</span></code>.
Here is the schematic for a correct call of the function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">      [e/x]f_pre  // prove the precondition, where  e  binds to parameter x</span>
<span class="s2">}&quot;&quot;&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>                               <span class="o">//</span> <span class="n">y</span>  <span class="n">does</span> <span class="ow">not</span> <span class="n">appear</span> <span class="ow">in</span>  <span class="n">e</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     1. [y/ans][e/x]f_post      premise   // presume the post-condition where</span>
<span class="s2">                                          //y  receives the  result  value</span>
<span class="s2">     2. [y_old/y][e/x]f_pre     premise</span>
<span class="s2">     . . .</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Recall that <code class="docutils literal notranslate"><span class="pre">[e/x]f_pre</span></code> defines a substitution of <code class="docutils literal notranslate"><span class="pre">e</span></code> for all
occurrences of <code class="docutils literal notranslate"><span class="pre">x</span></code> within formula <code class="docutils literal notranslate"><span class="pre">f_pre</span></code>.
The other two substitions explain how <code class="docutils literal notranslate"><span class="pre">f_post</span></code> is stated in terms of the
receiving variable, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and how the entry premise is propagated after
the call.</p>
</li>
<li><p>When we use a procedure, that is, a function that updates a global variable,
the laws become more complex, because the global variable acts like a second
answer from the function.
Every global variable should have an invariant property, and every function
that uses the global variable should pledge to preserve that invariant
property:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="o">...</span>                    <span class="o">//</span> <span class="n">the</span> <span class="k">global</span> <span class="n">variable</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">      ... proof of I_g     // the invariant property for g</span>
<span class="s2">}&quot;&quot;&quot;</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">    invariant I_g</span>
<span class="s2">}&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">         pre    Q    (where assertion  Q  can mention  x)   Call this,  f_pre.</span>
<span class="s2">         modifies ... (where parameters and globals are listed if modified)</span>
<span class="s2">         post   R    (where assertion  R  can mention  result and x)  Call this,  f_post.</span>
<span class="s2">    } &quot;&quot;&quot;</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">        1.  Q     premise</span>
<span class="s2">        2.  I_g   premise</span>
<span class="s2">    }&quot;&quot;&quot;</span>
    <span class="n">BODY</span>                   <span class="o">//</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">assign</span> <span class="n">to</span>  <span class="n">x</span>  <span class="n">but</span> <span class="n">may</span> <span class="n">assign</span> <span class="n">to</span>  <span class="n">g</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">         ... prove R</span>
<span class="s2">         ... prove  I_g</span>
<span class="s2">    }&quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For the function’s invocation, we deduce <code class="docutils literal notranslate"><span class="pre">[e/x]pre_f</span></code> to get the result.
Since global variable <code class="docutils literal notranslate"><span class="pre">g</span></code> acts as a second answer variable, <code class="docutils literal notranslate"><span class="pre">g</span></code> cannot
appear in argument <code class="docutils literal notranslate"><span class="pre">e</span></code> nor can it be the same as <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">      [e/x]pre_f,  that is,  Q_e,g</span>
<span class="s2">}&quot;&quot;&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>   <span class="o">//</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">g</span>  <span class="n">do</span> <span class="ow">not</span> <span class="n">appear</span> <span class="ow">in</span>  <span class="n">e</span><span class="p">,</span>  <span class="ow">and</span>  <span class="n">y</span> <span class="ow">and</span> <span class="n">g</span>  <span class="n">are</span> <span class="n">distinct</span> <span class="n">names</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     1. [y/ans][e/x][g_old/g_in]f_post      premise</span>
<span class="s2">     2. [y_old/y][g_old/g][e/x]f_pre        premise</span>
<span class="s2">     3. I_g                                 globalinv</span>
<span class="s2">     ...</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Further, <strong>provided that all assignments to global variable ``g`` occur only
within functions that preserve its ``I_g``</strong>, we can always assert <code class="docutils literal notranslate"><span class="pre">I_g</span></code> as
needed in the main program.</p>
</li>
<li><p>If we wish to reason in a backwards fashion about function calls, we can use
a different law.
To keep it simple, assume no global variables are updated by the function.
For the specification,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">:</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">         pre    Q    (where assertion  Q  can mention  x)   Call this,  f_pre.</span>
<span class="s2">         modifies ... (where parameters and globals are listed if modified)</span>
<span class="s2">         post   R    (where assertion  R  can mention  result and x)  Call this,  f_post.</span>
<span class="s2">    } &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>if a call to <code class="docutils literal notranslate"><span class="pre">f</span></code> is meant to achieve a goal, <code class="docutils literal notranslate"><span class="pre">G</span></code>, we reason backwards
from <code class="docutils literal notranslate"><span class="pre">G</span></code> to its subgoal like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     subgoal:  [e/x]pre_f  ^  ([e/x][y/ans]post_f --&gt; G)</span>
<span class="s2">}&quot;&quot;&quot;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  <span class="o">//</span> <span class="n">y</span>  <span class="n">does</span> <span class="ow">not</span> <span class="n">appear</span> <span class="ow">in</span> <span class="n">argument</span>  <span class="n">e</span>
<span class="n">l</span><span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">     goal: G</span>
<span class="s2">}&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>It is a good exercise to extend this backwards law to procedures.
Try it.</p>
</li>
</ol>
<hr class="docutils" />
<p align=right><small><em>
This note was adapted from David Schmidt's CIS 301, 2008,
<a href="http://people.cis.ksu.edu/~schmidt/301s14/Lectures/3procT.html">Chapter 3</a>
course note.
</em></small></p>
<p align=right><small><em>
It was updated in 2018 by Dr John Hatcliff and George Lavezzi <br>
to conform with Logika syntax and more closely match <br>
KSU's CIS 301 course as taught in Spring 2018.
</em></small></p></section>
</section>


    </div>
      
  </div>
</div>

  </body>
</html>